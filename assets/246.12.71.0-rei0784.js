(self.webpackChunkmisskey=self.webpackChunkmisskey||[]).push([[246],{94039:(e,s,t)=>{var a=t(23645)((function(e){return e[1]}));a.push([e.id,'.mk-messaging>.start[data-v-4c229569]{margin:0 auto var(--margin) auto}.mk-messaging>.history>.message[data-v-4c229569]{display:block;text-decoration:none;margin-bottom:var(--margin)}.mk-messaging>.history>.message *[data-v-4c229569]{pointer-events:none;user-select:none}.mk-messaging>.history>.message:hover .avatar[data-v-4c229569]{filter:saturate(200%)}.mk-messaging>.history>.message.isMe[data-v-4c229569],.mk-messaging>.history>.message.isRead[data-v-4c229569]{opacity:.8}.mk-messaging>.history>.message:not(.isMe):not(.isRead)>div[data-v-4c229569]{background-image:url(/assets/unread.svg);background-repeat:no-repeat;background-position:0}.mk-messaging>.history>.message[data-v-4c229569]:after{content:"";display:block;clear:both}.mk-messaging>.history>.message>div[data-v-4c229569]{padding:20px 30px}.mk-messaging>.history>.message>div[data-v-4c229569]:after{content:"";display:block;clear:both}.mk-messaging>.history>.message>div>header[data-v-4c229569]{display:flex;align-items:center;margin-bottom:2px;white-space:nowrap;overflow:hidden}.mk-messaging>.history>.message>div>header>.name[data-v-4c229569]{margin:0;padding:0;overflow:hidden;text-overflow:ellipsis;font-size:1em;font-weight:700;transition:all .1s ease}.mk-messaging>.history>.message>div>header>.username[data-v-4c229569]{margin:0 8px}.mk-messaging>.history>.message>div>header>.time[data-v-4c229569]{margin:0 0 0 auto}.mk-messaging>.history>.message>div>.avatar[data-v-4c229569]{float:left;width:54px;height:54px;margin:0 16px 0 0;border-radius:8px;transition:all .1s ease}.mk-messaging>.history>.message>div>.body>.text[data-v-4c229569]{display:block;margin:0;padding:0;overflow:hidden;overflow-wrap:break-word;font-size:1.1em;color:var(--faceText)}.mk-messaging>.history>.message>div>.body>.text .me[data-v-4c229569]{opacity:.7}.mk-messaging>.history>.message>div>.body>.image[data-v-4c229569]{display:block;max-width:100%;max-height:512px}.mk-messaging.max-width_400px>.history>.message:not(.isMe):not(.isRead)>div[data-v-4c229569]{background-image:none;border-left:4px solid #3aa2dc}.mk-messaging.max-width_400px>.history>.message>div[data-v-4c229569]{padding:16px;font-size:.9em}.mk-messaging.max-width_400px>.history>.message>div>.avatar[data-v-4c229569]{margin:0 12px 0 0}',""]),e.exports=a},30246:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>V});var a=t(55393);const i=(0,a.withScopeId)("data-v-4c229569");(0,a.pushScopeId)("data-v-4c229569");const o={class:"_section"},n={class:"mk-messaging _content"},r={key:0,class:"history"},c={key:0},d={class:"name"},g={key:1},m={class:"name"},l={class:"username"},p={class:"body"},h={class:"text"},u={key:0,class:"me"},v={key:1,class:"_fullinfo"},k=(0,a.createVNode)("img",{src:"https://xn--931a.moe/assets/info.jpg",class:"_ghost"},null,-1);(0,a.popScopeId)();const y=i(((e,s,t,y,f,x)=>{const w=(0,a.resolveComponent)("Fa"),I=(0,a.resolveComponent)("MkButton"),b=(0,a.resolveComponent)("MkAvatar"),N=(0,a.resolveComponent)("MkTime"),V=(0,a.resolveComponent)("MkUserName"),B=(0,a.resolveComponent)("MkA"),M=(0,a.resolveComponent)("MkLoading"),C=(0,a.resolveDirective)("anim"),$=(0,a.resolveDirective)("size");return(0,a.openBlock)(),(0,a.createBlock)("div",o,[(0,a.withDirectives)((0,a.createVNode)("div",n,[(0,a.createVNode)(I,{onClick:e.start,primary:"",class:"start"},{default:i((()=>[(0,a.createVNode)(w,{icon:e.faPlus},null,8,["icon"]),(0,a.createTextVNode)(" "+(0,a.toDisplayString)(e.$ts.startMessaging),1)])),_:1},8,["onClick"]),e.messages.length>0?((0,a.openBlock)(),(0,a.createBlock)("div",r,[((0,a.openBlock)(!0),(0,a.createBlock)(a.Fragment,null,(0,a.renderList)(e.messages,((s,t)=>(0,a.withDirectives)(((0,a.openBlock)(),(0,a.createBlock)(B,{class:["message _panel",{isMe:e.isMe(s),isRead:s.groupId?s.reads.includes(e.$i.id):s.isRead}],to:s.groupId?"/my/messaging/group/"+s.groupId:"/my/messaging/"+e.getAcct(e.isMe(s)?s.recipient:s.user),"data-index":t,key:s.id},{default:i((()=>[(0,a.createVNode)("div",null,[(0,a.createVNode)(b,{class:"avatar",user:s.groupId?s.user:e.isMe(s)?s.recipient:s.user},null,8,["user"]),s.groupId?((0,a.openBlock)(),(0,a.createBlock)("header",c,[(0,a.createVNode)("span",d,(0,a.toDisplayString)(s.group.name),1),(0,a.createVNode)(N,{time:s.createdAt,class:"time"},null,8,["time"])])):((0,a.openBlock)(),(0,a.createBlock)("header",g,[(0,a.createVNode)("span",m,[(0,a.createVNode)(V,{user:e.isMe(s)?s.recipient:s.user},null,8,["user"])]),(0,a.createVNode)("span",l,"@"+(0,a.toDisplayString)(e.acct(e.isMe(s)?s.recipient:s.user)),1),(0,a.createVNode)(N,{time:s.createdAt,class:"time"},null,8,["time"])])),(0,a.createVNode)("div",p,[(0,a.createVNode)("p",h,[e.isMe(s)?((0,a.openBlock)(),(0,a.createBlock)("span",u,(0,a.toDisplayString)(e.$ts.you)+":",1)):(0,a.createCommentVNode)("",!0),(0,a.createTextVNode)((0,a.toDisplayString)(s.text),1)])])])])),_:2},1032,["class","to","data-index"])),[[C,t]]))),128))])):(0,a.createCommentVNode)("",!0),e.fetching||0!=e.messages.length?(0,a.createCommentVNode)("",!0):((0,a.openBlock)(),(0,a.createBlock)("div",v,[k,(0,a.createVNode)("div",null,(0,a.toDisplayString)(e.$ts.noHistory),1)])),e.fetching?((0,a.openBlock)(),(0,a.createBlock)(M,{key:2})):(0,a.createCommentVNode)("",!0)],512),[[$,{max:[400]}]])])}));var f=t(51436),x=t(73115),w=t(42453),I=t(55006),b=t(10192);const N=(0,a.defineComponent)({components:{MkButton:w.Z},data(){return{INFO:{title:this.$ts.messaging,icon:f.lXL},fetching:!0,moreFetching:!1,messages:[],connection:null,faUser:f.ILF,faUsers:f.FVb,faComments:f.lXL,faPlus:f.r8p}},mounted(){this.connection=b.Vw.useSharedConnection("messagingIndex"),this.connection.on("message",this.onMessage),this.connection.on("read",this.onRead),b.hi("messaging/history",{group:!1}).then((e=>{b.hi("messaging/history",{group:!0}).then((s=>{const t=e.concat(s);t.sort(((e,s)=>new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime())),this.messages=t,this.fetching=!1}))}))},beforeUnmount(){this.connection.dispose()},methods:{getAcct:x.Z,isMe(e){return e.userId==this.$i.id},onMessage(e){e.recipientId?(this.messages=this.messages.filter((s=>!(s.recipientId==e.recipientId&&s.userId==e.userId||s.recipientId==e.userId&&s.userId==e.recipientId))),this.messages.unshift(e)):e.groupId&&(this.messages=this.messages.filter((s=>s.groupId!==e.groupId)),this.messages.unshift(e))},onRead(e){for(const s of e){const e=this.messages.find((e=>e.id==s));e&&(e.recipientId?e.isRead=!0:e.groupId&&e.reads.push(this.$i.id))}},start(e){b.n4([{text:this.$ts.messagingWithUser,icon:f.ILF,action:()=>{this.startUser()}},{text:this.$ts.messagingWithGroup,icon:f.FVb,action:()=>{this.startGroup()}}],e.currentTarget||e.target)},async startUser(){b.dy().then((e=>{this.$router.push("/my/messaging/"+(0,x.Z)(e))}))},async startGroup(){const e=await b.hi("users/groups/owned"),s=await b.hi("users/groups/joined");if(0===e.length&&0===s.length)return void b.WZ({type:"warning",title:this.$ts.youHaveNoGroups,text:this.$ts.joinOrCreateGroup});const{canceled:t,result:a}=await b.WZ({type:null,title:this.$ts.group,select:{items:e.concat(s).map((e=>({value:e,text:e.name})))},showCancelButton:!0});t||this.$router.push("/my/messaging/group/"+a.id)},acct:I.R}});t(50335);N.render=y,N.__scopeId="data-v-4c229569";const V=N},50335:(e,s,t)=>{var a=t(94039);"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);(0,t(45346).Z)("47ac9e58",a,!0,{})}}]);