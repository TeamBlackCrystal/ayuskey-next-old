/*! For license information please see 1127.12.71.0-rei0784.js.LICENSE.txt */
(self.webpackChunkmisskey=self.webpackChunkmisskey||[]).push([[1127],{79367:function(e,t){var n,o,i;o=[e,t],void 0===(i="function"==typeof(n=function(e,t){"use strict";var n,o,i="function"==typeof Map?new Map:(n=[],o=[],{has:function(e){return n.indexOf(e)>-1},get:function(e){return o[n.indexOf(e)]},set:function(e,t){-1===n.indexOf(e)&&(n.push(e),o.push(t))},delete:function(e){var t=n.indexOf(e);t>-1&&(n.splice(t,1),o.splice(t,1))}}),r=function(e){return new Event(e,{bubbles:!0})};try{new Event("test")}catch(e){r=function(e){var t=document.createEvent("Event");return t.initEvent(e,!0,!1),t}}function a(e){if(e&&e.nodeName&&"TEXTAREA"===e.nodeName&&!i.has(e)){var t=null,n=null,o=null,a=function(){e.clientWidth!==n&&u()},s=function(t){window.removeEventListener("resize",a,!1),e.removeEventListener("input",u,!1),e.removeEventListener("keyup",u,!1),e.removeEventListener("autosize:destroy",s,!1),e.removeEventListener("autosize:update",u,!1),Object.keys(t).forEach((function(n){e.style[n]=t[n]})),i.delete(e)}.bind(e,{height:e.style.height,resize:e.style.resize,overflowY:e.style.overflowY,overflowX:e.style.overflowX,wordWrap:e.style.wordWrap});e.addEventListener("autosize:destroy",s,!1),"onpropertychange"in e&&"oninput"in e&&e.addEventListener("keyup",u,!1),window.addEventListener("resize",a,!1),e.addEventListener("input",u,!1),e.addEventListener("autosize:update",u,!1),e.style.overflowX="hidden",e.style.wordWrap="break-word",i.set(e,{destroy:s,update:u}),l()}function l(){var n=window.getComputedStyle(e,null);"vertical"===n.resize?e.style.resize="none":"both"===n.resize&&(e.style.resize="horizontal"),t="content-box"===n.boxSizing?-(parseFloat(n.paddingTop)+parseFloat(n.paddingBottom)):parseFloat(n.borderTopWidth)+parseFloat(n.borderBottomWidth),isNaN(t)&&(t=0),u()}function d(t){var n=e.style.width;e.style.width="0px",e.offsetWidth,e.style.width=n,e.style.overflowY=t}function c(e){for(var t=[];e&&e.parentNode&&e.parentNode instanceof Element;)e.parentNode.scrollTop&&t.push({node:e.parentNode,scrollTop:e.parentNode.scrollTop}),e=e.parentNode;return t}function p(){if(0!==e.scrollHeight){var o=c(e),i=document.documentElement&&document.documentElement.scrollTop;e.style.height="",e.style.height=e.scrollHeight+t+"px",n=e.clientWidth,o.forEach((function(e){e.node.scrollTop=e.scrollTop})),i&&(document.documentElement.scrollTop=i)}}function u(){p();var t=Math.round(parseFloat(e.style.height)),n=window.getComputedStyle(e,null),i="content-box"===n.boxSizing?Math.round(parseFloat(n.height)):e.offsetHeight;if(i<t?"hidden"===n.overflowY&&(d("scroll"),p(),i="content-box"===n.boxSizing?Math.round(parseFloat(window.getComputedStyle(e,null).height)):e.offsetHeight):"hidden"!==n.overflowY&&(d("hidden"),p(),i="content-box"===n.boxSizing?Math.round(parseFloat(window.getComputedStyle(e,null).height)):e.offsetHeight),o!==i){o=i;var a=r("autosize:resized");try{e.dispatchEvent(a)}catch(e){}}}}function s(e){var t=i.get(e);t&&t.destroy()}function l(e){var t=i.get(e);t&&t.update()}var d=null;"undefined"==typeof window||"function"!=typeof window.getComputedStyle?((d=function(e){return e}).destroy=function(e){return e},d.update=function(e){return e}):((d=function(e,t){return e&&Array.prototype.forEach.call(e.length?e:[e],(function(e){return a(e,t)})),e}).destroy=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],s),e},d.update=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],l),e}),t.default=d,e.exports=t.default})?n.apply(t,o):n)||(e.exports=i)},29995:(e,t,n)=>{var o=n(23645)((function(e){return e[1]}));o.push([e.id,'.mk-messaging-form[data-v-7130579c]{position:relative}.mk-messaging-form>textarea[data-v-7130579c]{cursor:auto;display:block;width:100%;min-width:100%;max-width:100%;height:80px;margin:0;padding:16px 16px 0;resize:none;font-size:1em;font-family:inherit;outline:none;border:none;border-radius:0;box-shadow:none;background:transparent;box-sizing:border-box;color:var(--fg)}.mk-messaging-form>.file[data-v-7130579c]{padding:8px;color:#444;background:#eee;cursor:pointer}.mk-messaging-form>.send[data-v-7130579c]{position:absolute;bottom:0;right:0;margin:0;padding:16px;font-size:1em;transition:color .1s ease;color:var(--accent)}.mk-messaging-form>.send[data-v-7130579c]:active{color:var(--accentDarken);transition:color 0s ease}.mk-messaging-form .files[data-v-7130579c]{display:block;margin:0;padding:0 8px;list-style:none}.mk-messaging-form .files[data-v-7130579c]:after{content:"";display:block;clear:both}.mk-messaging-form .files>li[data-v-7130579c]{display:block;float:left;margin:4px;padding:0;width:64px;height:64px;background-color:#eee;background-repeat:no-repeat;background-position:50%;background-size:cover;cursor:move}.mk-messaging-form .files>li:hover>.remove[data-v-7130579c]{display:block}.mk-messaging-form .files>li>.remove[data-v-7130579c]{display:none;position:absolute;right:-6px;top:-6px;margin:0;padding:0;background:transparent;outline:none;border:none;border-radius:0;box-shadow:none;cursor:pointer}.mk-messaging-form ._button[data-v-7130579c]{margin:0;padding:16px;font-size:1em;font-weight:400;text-decoration:none;transition:color .1s ease}.mk-messaging-form ._button[data-v-7130579c]:hover{color:var(--accent)}.mk-messaging-form ._button[data-v-7130579c]:active{color:var(--accentDarken);transition:color 0s ease}.mk-messaging-form input[type=file][data-v-7130579c]{display:none}',""]),e.exports=o},71127:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>h});var o=n(55393);const i=(0,o.withScopeId)("data-v-7130579c")(((e,t,n,i,r,a)=>{const s=(0,o.resolveComponent)("Fa");return(0,o.openBlock)(),(0,o.createBlock)("div",{class:"mk-messaging-form _panel",onDragover:t[10]||(t[10]=(0,o.withModifiers)(((...t)=>e.onDragover&&e.onDragover(...t)),["stop"])),onDrop:t[11]||(t[11]=(0,o.withModifiers)(((...t)=>e.onDrop&&e.onDrop(...t)),["stop"]))},[(0,o.withDirectives)((0,o.createVNode)("textarea",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.text=t),ref:"text",onKeypress:t[2]||(t[2]=(...t)=>e.onKeypress&&e.onKeypress(...t)),onCompositionupdate:t[3]||(t[3]=(...t)=>e.onCompositionUpdate&&e.onCompositionUpdate(...t)),onPaste:t[4]||(t[4]=(...t)=>e.onPaste&&e.onPaste(...t)),placeholder:e.$ts.inputMessageHere},null,40,["placeholder"]),[[o.vModelText,e.text]]),e.file?((0,o.openBlock)(),(0,o.createBlock)("div",{key:0,class:"file",onClick:t[5]||(t[5]=t=>e.file=null)},(0,o.toDisplayString)(e.file.name),1)):(0,o.createCommentVNode)("",!0),(0,o.createVNode)("button",{class:"send _button",onClick:t[6]||(t[6]=(...t)=>e.send&&e.send(...t)),disabled:!e.canSend||e.sending,title:e.$ts.send},[e.sending?(0,o.createCommentVNode)("",!0):((0,o.openBlock)(),(0,o.createBlock)(s,{key:0,icon:e.faPaperPlane},null,8,["icon"])),e.sending?((0,o.openBlock)(),(0,o.createBlock)(s,{key:1,icon:"spinner .spin"})):(0,o.createCommentVNode)("",!0)],8,["disabled","title"]),(0,o.createVNode)("button",{class:"_button",onClick:t[7]||(t[7]=(...t)=>e.chooseFile&&e.chooseFile(...t))},[(0,o.createVNode)(s,{icon:e.faPhotoVideo},null,8,["icon"])]),(0,o.createVNode)("button",{class:"_button",onClick:t[8]||(t[8]=(...t)=>e.insertEmoji&&e.insertEmoji(...t))},[(0,o.createVNode)(s,{icon:e.faLaughSquint},null,8,["icon"])]),(0,o.createVNode)("input",{ref:"file",type:"file",onChange:t[9]||(t[9]=(...t)=>e.onChangeFile&&e.onChangeFile(...t))},null,544)],32)}));var r=n(51436),a=n(23691),s=n(79367),l=n(10857),d=n(14975),c=n(10192),p=n(53200),u=n(51084);const f=(0,o.defineComponent)({props:{user:{type:Object,requird:!1},group:{type:Object,requird:!1}},data(){return{text:null,file:null,sending:!1,typing:(0,u.P)(3e3,(()=>{c.Vw.send("typingOnMessaging",this.user?{partner:this.user.id}:{group:this.group.id})})),faPaperPlane:r.XCy,faPhotoVideo:r.zxC,faLaughSquint:r.unj}},computed:{draftKey(){return this.user?"user:"+this.user.id:"group:"+this.group.id},canSend(){return null!=this.text&&""!=this.text||null!=this.file},room(){return this.$parent}},watch:{text(){this.saveDraft()},file(){this.saveDraft()}},mounted(){s(this.$refs.text),new p.F(this.$refs.text,this,{model:"text"});const e=JSON.parse(localStorage.getItem("message_drafts")||"{}")[this.draftKey];e&&(this.text=e.data.text,this.file=e.data.file)},methods:{async onPaste(e){const t=e.clipboardData.items;if(1==t.length){if("file"==t[0].kind){const e=t[0].getAsFile(),n=e.name.lastIndexOf("."),o=n>=0?e.name.slice(n):"",i=`${(0,l.T)(new Date(e.lastModified),this.$store.state.pastedFileName).replace(/{{number}}/g,"1")}${o}`,r=this.$store.state.pasteDialog?await c.WZ({title:this.$ts.enterFileName,input:{default:i},allowEmpty:!1}).then((({canceled:e,result:t})=>!e&&t)):i;r&&this.upload(e,r)}}else"file"==t[0].kind&&c.WZ({type:"error",text:this.$ts.onlyOneFileCanBeAttached})},onDragover(e){const t="file"==e.dataTransfer.items[0].kind,n="mk_drive_file"==e.dataTransfer.types[0];(t||n)&&(e.preventDefault(),e.dataTransfer.dropEffect="all"==e.dataTransfer.effectAllowed?"copy":"move")},onDrop(e){if(1==e.dataTransfer.files.length)return e.preventDefault(),void this.upload(e.dataTransfer.files[0]);if(e.dataTransfer.files.length>1)return e.preventDefault(),void c.WZ({type:"error",text:this.$ts.onlyOneFileCanBeAttached});const t=e.dataTransfer.getData("mk_drive_file");null!=t&&""!=t&&(this.file=JSON.parse(t),e.preventDefault())},onKeypress(e){this.typing(),10!=e.which&&13!=e.which||!e.ctrlKey&&!e.metaKey||!this.canSend||this.send()},onCompositionUpdate(){this.typing()},chooseFile(e){(0,d.$)(e.currentTarget||e.target,this.$ts.selectFile,!1).then((e=>{this.file=e}))},onChangeFile(){this.upload(this.$refs.file.files[0])},upload(e,t){c.ws(e,this.$store.state.uploadFolder,t).then((e=>{this.file=e}))},send(){this.sending=!0,c.hi("messaging/messages/create",{userId:this.user?this.user.id:void 0,groupId:this.group?this.group.id:void 0,text:this.text?this.text:void 0,fileId:this.file?this.file.id:void 0}).then((e=>{this.clear()})).catch((e=>{console.error(e)})).then((()=>{this.sending=!1}))},clear(){this.text="",this.file=null,this.deleteDraft()},saveDraft(){const e=JSON.parse(localStorage.getItem("message_drafts")||"{}");e[this.draftKey]={updatedAt:new Date,data:{text:this.text,file:this.file}},localStorage.setItem("message_drafts",JSON.stringify(e))},deleteDraft(){const e=JSON.parse(localStorage.getItem("message_drafts")||"{}");delete e[this.draftKey],localStorage.setItem("message_drafts",JSON.stringify(e))},async insertEmoji(e){c.S7(e.currentTarget||e.target).then((e=>{(0,a.Z)(this.$refs.text,e)}))}}});n(30008);f.render=i,f.__scopeId="data-v-7130579c";const h=f},30008:(e,t,n)=>{var o=n(29995);"string"==typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);(0,n(45346).Z)("a10d25d2",o,!0,{})}}]);