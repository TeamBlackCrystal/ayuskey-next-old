(self.webpackChunkmisskey=self.webpackChunkmisskey||[]).push([[1976],{99874:(e,t,o)=>{var i=o(23645)((function(e){return e[1]}));i.push([e.id,".zdjebgpv[data-v-6ec0e189]{position:relative}.zdjebgpv>.icon-sub[data-v-6ec0e189]{position:absolute;width:30%;height:auto;margin:0;right:4%;bottom:4%}.zdjebgpv>*[data-v-6ec0e189]{margin:auto}.zdjebgpv>.icon[data-v-6ec0e189]{pointer-events:none;height:65%;width:65%}",""]),e.exports=i},2686:(e,t,o)=>{var i=o(23645)((function(e){return e[1]}));i.push([e.id,'.ncvczrfv[data-v-621adb49]{position:relative;padding:8px 0 0;min-height:180px;border-radius:4px}.ncvczrfv[data-v-621adb49],.ncvczrfv *[data-v-621adb49]{cursor:pointer}.ncvczrfv>*[data-v-621adb49]{pointer-events:none}.ncvczrfv[data-v-621adb49]:hover{background:rgba(0,0,0,.05)}.ncvczrfv:hover>.label[data-v-621adb49]:after,.ncvczrfv:hover>.label[data-v-621adb49]:before{background:#0b65a5}.ncvczrfv:hover>.label.red[data-v-621adb49]:after,.ncvczrfv:hover>.label.red[data-v-621adb49]:before{background:#c12113}.ncvczrfv[data-v-621adb49]:active{background:rgba(0,0,0,.1)}.ncvczrfv:active>.label[data-v-621adb49]:after,.ncvczrfv:active>.label[data-v-621adb49]:before{background:#0b588c}.ncvczrfv:active>.label.red[data-v-621adb49]:after,.ncvczrfv:active>.label.red[data-v-621adb49]:before{background:#ce2212}.ncvczrfv.isSelected[data-v-621adb49]{background:var(--accent)}.ncvczrfv.isSelected[data-v-621adb49]:hover{background:var(--accentLighten)}.ncvczrfv.isSelected[data-v-621adb49]:active{background:var(--accentDarken)}.ncvczrfv.isSelected>.label[data-v-621adb49]:after,.ncvczrfv.isSelected>.label[data-v-621adb49]:before{display:none}.ncvczrfv.isSelected>.name[data-v-621adb49],.ncvczrfv.isSelected>.thumbnail[data-v-621adb49]{color:#fff}.ncvczrfv>.label[data-v-621adb49]{position:absolute;top:0;left:0;pointer-events:none}.ncvczrfv>.label[data-v-621adb49]:after,.ncvczrfv>.label[data-v-621adb49]:before{content:"";display:block;position:absolute;z-index:1;background:#0c7ac9}.ncvczrfv>.label[data-v-621adb49]:before{top:0;left:57px;width:28px;height:8px}.ncvczrfv>.label[data-v-621adb49]:after{top:57px;left:0;width:8px;height:28px}.ncvczrfv>.label.red[data-v-621adb49]:after,.ncvczrfv>.label.red[data-v-621adb49]:before{background:#c12113}.ncvczrfv>.label>img[data-v-621adb49]{position:absolute;z-index:2;top:0;left:0}.ncvczrfv>.label>p[data-v-621adb49]{position:absolute;z-index:3;top:19px;left:-28px;width:120px;margin:0;text-align:center;line-height:28px;color:#fff;transform:rotate(-45deg)}.ncvczrfv>.thumbnail[data-v-621adb49]{width:128px;height:128px;margin:auto}.ncvczrfv>.name[data-v-621adb49]{display:block;margin:4px 0 0;font-size:.8em;text-align:center;word-break:break-all;color:var(--fg);overflow:hidden}.ncvczrfv>.name>.ext[data-v-621adb49]{opacity:.5}',""]),e.exports=i},29671:(e,t,o)=>{var i=o(23645)((function(e){return e[1]}));i.push([e.id,'.rghtznwe[data-v-70632120]{position:relative;padding:8px;height:64px;background:var(--driveFolderBg);border-radius:4px}.rghtznwe[data-v-70632120],.rghtznwe *[data-v-70632120]{cursor:pointer}.rghtznwe[data-v-70632120] :not(.checkbox){pointer-events:none}.rghtznwe>.checkbox[data-v-70632120]{position:absolute;bottom:8px;right:8px;width:16px;height:16px;background:#fff;border:1px solid #000}.rghtznwe>.checkbox.checked[data-v-70632120]{background:var(--accent)}.rghtznwe.draghover[data-v-70632120]:after{content:"";pointer-events:none;position:absolute;top:-4px;right:-4px;bottom:-4px;left:-4px;border:2px dashed var(--focus);border-radius:4px}.rghtznwe>.name[data-v-70632120]{margin:0;font-size:.9em;color:var(--desktopDriveFolderFg)}.rghtznwe>.name>[data-icon][data-v-70632120]{margin-right:4px;margin-left:2px;text-align:left}.rghtznwe>.upload[data-v-70632120]{margin:4px;font-size:.8em;text-align:right;color:var(--desktopDriveFolderFg)}',""]),e.exports=i},54780:(e,t,o)=>{var i=o(23645)((function(e){return e[1]}));i.push([e.id,".drylbebk>*[data-v-487bfa20]{pointer-events:none}.drylbebk.draghover[data-v-487bfa20]{background:#eee}.drylbebk>i[data-v-487bfa20]{margin-right:4px}",""]),e.exports=i},93259:(e,t,o)=>{var i=o(23645)((function(e){return e[1]}));i.push([e.id,".yfudmmck[data-v-60c142c4]{display:flex;flex-direction:column;height:100%}.yfudmmck>nav[data-v-60c142c4]{display:block;z-index:2;width:100%;padding:0 8px;box-sizing:border-box;overflow:auto;font-size:.9em;box-shadow:0 1px 0 var(--divider)}.yfudmmck>nav[data-v-60c142c4],.yfudmmck>nav *[data-v-60c142c4]{user-select:none}.yfudmmck>nav>.path[data-v-60c142c4]{display:inline-block;vertical-align:bottom;line-height:38px;white-space:nowrap}.yfudmmck>nav>.path>*[data-v-60c142c4]{display:inline-block;margin:0;padding:0 8px;line-height:38px;cursor:pointer}.yfudmmck>nav>.path>* *[data-v-60c142c4]{pointer-events:none}.yfudmmck>nav>.path[data-v-60c142c4]>:hover{text-decoration:underline}.yfudmmck>nav>.path>.current[data-v-60c142c4]{font-weight:700;cursor:default}.yfudmmck>nav>.path>.current[data-v-60c142c4]:hover{text-decoration:none}.yfudmmck>nav>.path>.separator[data-v-60c142c4]{margin:0;padding:0;opacity:.5;cursor:default}.yfudmmck>nav>.path>.separator>[data-icon][data-v-60c142c4]{margin:0}.yfudmmck>.main[data-v-60c142c4]{flex:1;overflow:auto}.yfudmmck>.main[data-v-60c142c4],.yfudmmck>.main *[data-v-60c142c4]{user-select:none}.yfudmmck>.main.fetching[data-v-60c142c4]{cursor:wait!important}.yfudmmck>.main.fetching *[data-v-60c142c4]{pointer-events:none}.yfudmmck>.main.fetching>.contents[data-v-60c142c4]{opacity:.5}.yfudmmck>.main.uploading[data-v-60c142c4]{height:calc(100% - 138px)}.yfudmmck>.main>.contents>.files[data-v-60c142c4],.yfudmmck>.main>.contents>.folders[data-v-60c142c4]{display:flex;flex-wrap:wrap}.yfudmmck>.main>.contents>.files>.file[data-v-60c142c4],.yfudmmck>.main>.contents>.files>.folder[data-v-60c142c4],.yfudmmck>.main>.contents>.folders>.file[data-v-60c142c4],.yfudmmck>.main>.contents>.folders>.folder[data-v-60c142c4]{flex-grow:1;width:144px;margin:4px;box-sizing:border-box}.yfudmmck>.main>.contents>.files>.padding[data-v-60c142c4],.yfudmmck>.main>.contents>.folders>.padding[data-v-60c142c4]{flex-grow:1;pointer-events:none;width:152px}.yfudmmck>.main>.contents>.empty[data-v-60c142c4]{padding:16px;text-align:center;pointer-events:none;opacity:.5}.yfudmmck>.main>.contents>.empty>p[data-v-60c142c4]{margin:0}.yfudmmck>.dropzone[data-v-60c142c4]{position:absolute;left:0;top:38px;width:100%;height:calc(100% - 38px);border:2px dashed var(--focus);pointer-events:none}.yfudmmck>input[data-v-60c142c4]{display:none}",""]),e.exports=i},797:(e,t,o)=>{"use strict";o.d(t,{Z:()=>h});var i=o(55393);const r=(0,i.withScopeId)("data-v-6ec0e189");(0,i.pushScopeId)("data-v-6ec0e189");const a={class:"zdjebgpv",ref:"thumbnail"};(0,i.popScopeId)();const l=r(((e,t,o,r,l,n)=>{const s=(0,i.resolveComponent)("ImgWithBlurhash"),d=(0,i.resolveComponent)("Fa");return(0,i.openBlock)(),(0,i.createBlock)("div",a,[e.isThumbnailAvailable?((0,i.openBlock)(),(0,i.createBlock)(s,{key:0,hash:e.file.blurhash,src:e.file.thumbnailUrl,alt:e.file.name,title:e.file.name,style:"object-fit: "+e.fit},null,8,["hash","src","alt","title","style"])):"image"===e.is?((0,i.openBlock)(),(0,i.createBlock)(d,{key:1,icon:e.faFileImage,class:"icon"},null,8,["icon"])):"video"===e.is?((0,i.openBlock)(),(0,i.createBlock)(d,{key:2,icon:e.faFileVideo,class:"icon"},null,8,["icon"])):"audio"===e.is||"midi"===e.is?((0,i.openBlock)(),(0,i.createBlock)(d,{key:3,icon:e.faMusic,class:"icon"},null,8,["icon"])):"csv"===e.is?((0,i.openBlock)(),(0,i.createBlock)(d,{key:4,icon:e.faFileCsv,class:"icon"},null,8,["icon"])):"pdf"===e.is?((0,i.openBlock)(),(0,i.createBlock)(d,{key:5,icon:e.faFilePdf,class:"icon"},null,8,["icon"])):"textfile"===e.is?((0,i.openBlock)(),(0,i.createBlock)(d,{key:6,icon:e.faFileAlt,class:"icon"},null,8,["icon"])):"archive"===e.is?((0,i.openBlock)(),(0,i.createBlock)(d,{key:7,icon:e.faFileArchive,class:"icon"},null,8,["icon"])):((0,i.openBlock)(),(0,i.createBlock)(d,{key:8,icon:e.faFile,class:"icon"},null,8,["icon"])),e.isThumbnailAvailable&&"video"===e.is?((0,i.openBlock)(),(0,i.createBlock)(d,{key:9,icon:e.faFilm,class:"icon-sub"},null,8,["icon"])):(0,i.createCommentVNode)("",!0)],512)}));var n=o(51436),s=o(27718),d=o(73120);const c=(0,i.defineComponent)({components:{ImgWithBlurhash:s.Z},props:{file:{type:Object,required:!0},fit:{type:String,required:!1,default:"cover"}},data:()=>({isContextmenuShowing:!1,isDragging:!1,faFile:n.gMD,faFileAlt:n.cwv,faFileImage:n.Oi0,faMusic:n.Xig,faFileVideo:n.hvm,faFileCsv:n.fUD,faFilePdf:n.gSj,faFileArchive:n.W2U,faFilm:n.CjD}),computed:{is(){return this.file.type.startsWith("image/")?"image":this.file.type.startsWith("video/")?"video":"audio/midi"===this.file.type?"midi":this.file.type.startsWith("audio/")?"audio":this.file.type.endsWith("/csv")?"csv":this.file.type.endsWith("/pdf")?"pdf":this.file.type.startsWith("text/")?"textfile":["application/zip","application/x-cpio","application/x-bzip","application/x-bzip2","application/java-archive","application/x-rar-compressed","application/x-tar","application/gzip","application/x-7z-compressed"].some((e=>e===this.file.type))?"archive":"unknown"},isThumbnailAvailable(){return!!this.file.thumbnailUrl&&("image"===this.is||"video"===this.is)}},mounted(){const e=this.$refs.volumectrl;e&&(e.volume=d.cP.get("mediaVolume"))},methods:{volumechange(){const e=this.$refs.volumectrl;d.cP.set("mediaVolume",e.volume)}}});o(21969);c.render=l,c.__scopeId="data-v-6ec0e189";const h=c},61976:(e,t,o)=>{"use strict";o.d(t,{Z:()=>G});var i=o(55393);const r=(0,i.withScopeId)("data-v-60c142c4");(0,i.pushScopeId)("data-v-60c142c4");const a={class:"yfudmmck"},l={class:"separator"},n={key:0,class:"separator"},s={key:1,class:"folder current"},d={class:"contents",ref:"contents"},c={class:"folders",ref:"foldersContainer"},h={class:"files",ref:"filesContainer"},f={key:0,class:"empty"},p={key:0},v={key:1},m=(0,i.createVNode)("br",null,null,-1),u={key:2},g={key:0,class:"dropzone"};(0,i.popScopeId)();const k=r(((e,t,o,k,b,y)=>{const F=(0,i.resolveComponent)("XNavFolder"),x=(0,i.resolveComponent)("Fa"),D=(0,i.resolveComponent)("XFolder"),w=(0,i.resolveComponent)("MkButton"),C=(0,i.resolveComponent)("XFile"),B=(0,i.resolveComponent)("MkLoading"),S=(0,i.resolveDirective)("anim");return(0,i.openBlock)(),(0,i.createBlock)("div",a,[(0,i.createVNode)("nav",null,[(0,i.createVNode)("div",{class:"path",onContextmenu:t[1]||(t[1]=(0,i.withModifiers)((()=>{}),["prevent","stop"]))},[(0,i.createVNode)(F,{class:{current:null==e.folder}},null,8,["class"]),((0,i.openBlock)(!0),(0,i.createBlock)(i.Fragment,null,(0,i.renderList)(e.hierarchyFolders,(t=>((0,i.openBlock)(),(0,i.createBlock)(i.Fragment,null,[(0,i.createVNode)("span",l,[(0,i.createVNode)(x,{icon:e.faAngleRight},null,8,["icon"])]),(0,i.createVNode)(F,{folder:t},null,8,["folder"])],64)))),256)),null!=e.folder?((0,i.openBlock)(),(0,i.createBlock)("span",n,[(0,i.createVNode)(x,{icon:e.faAngleRight},null,8,["icon"])])):(0,i.createCommentVNode)("",!0),null!=e.folder?((0,i.openBlock)(),(0,i.createBlock)("span",s,(0,i.toDisplayString)(e.folder.name),1)):(0,i.createCommentVNode)("",!0)],32)]),(0,i.createVNode)("div",{class:["main _section",{uploading:e.uploadings.length>0,fetching:e.fetching}],ref:"main",onDragover:t[2]||(t[2]=(0,i.withModifiers)(((...t)=>e.onDragover&&e.onDragover(...t)),["prevent","stop"])),onDragenter:t[3]||(t[3]=(...t)=>e.onDragenter&&e.onDragenter(...t)),onDragleave:t[4]||(t[4]=(...t)=>e.onDragleave&&e.onDragleave(...t)),onDrop:t[5]||(t[5]=(0,i.withModifiers)(((...t)=>e.onDrop&&e.onDrop(...t)),["prevent","stop"])),onContextmenu:t[6]||(t[6]=(0,i.withModifiers)(((...t)=>e.onContextmenu&&e.onContextmenu(...t)),["stop"]))},[(0,i.createVNode)("div",d,[(0,i.withDirectives)((0,i.createVNode)("div",c,[((0,i.openBlock)(!0),(0,i.createBlock)(i.Fragment,null,(0,i.renderList)(e.folders,((t,o)=>(0,i.withDirectives)(((0,i.openBlock)(),(0,i.createBlock)(D,{key:t.id,class:"folder",folder:t,"select-mode":"folder"===e.select,"is-selected":e.selectedFolders.some((e=>e.id===t.id)),onChosen:e.chooseFolder},null,8,["folder","select-mode","is-selected","onChosen"])),[[S,o]]))),128)),((0,i.openBlock)(),(0,i.createBlock)(i.Fragment,null,(0,i.renderList)(16,((e,t)=>(0,i.createVNode)("div",{class:"padding",key:t}))),64)),e.moreFolders?((0,i.openBlock)(),(0,i.createBlock)(w,{key:0,ref:"moreFolders"},{default:r((()=>[(0,i.createTextVNode)((0,i.toDisplayString)(e.$ts.loadMore),1)])),_:1},512)):(0,i.createCommentVNode)("",!0)],512),[[i.vShow,e.folders.length>0]]),(0,i.withDirectives)((0,i.createVNode)("div",h,[((0,i.openBlock)(!0),(0,i.createBlock)(i.Fragment,null,(0,i.renderList)(e.files,((t,o)=>(0,i.withDirectives)(((0,i.openBlock)(),(0,i.createBlock)(C,{key:t.id,class:"file",file:t,"select-mode":"file"===e.select,"is-selected":e.selectedFiles.some((e=>e.id===t.id)),onChosen:e.chooseFile},null,8,["file","select-mode","is-selected","onChosen"])),[[S,o]]))),128)),((0,i.openBlock)(),(0,i.createBlock)(i.Fragment,null,(0,i.renderList)(16,((e,t)=>(0,i.createVNode)("div",{class:"padding",key:t}))),64)),(0,i.withDirectives)((0,i.createVNode)(w,{ref:"loadMoreFiles",onClick:e.fetchMoreFiles},{default:r((()=>[(0,i.createTextVNode)((0,i.toDisplayString)(e.$ts.loadMore),1)])),_:1},8,["onClick"]),[[i.vShow,e.moreFiles]])],512),[[i.vShow,e.files.length>0]]),0!=e.files.length||0!=e.folders.length||e.fetching?(0,i.createCommentVNode)("",!0):((0,i.openBlock)(),(0,i.createBlock)("div",f,[e.draghover?((0,i.openBlock)(),(0,i.createBlock)("p",p,(0,i.toDisplayString)(e.$t("empty-draghover")),1)):(0,i.createCommentVNode)("",!0),e.draghover||null!=e.folder?(0,i.createCommentVNode)("",!0):((0,i.openBlock)(),(0,i.createBlock)("p",v,[(0,i.createVNode)("strong",null,(0,i.toDisplayString)(e.$ts.emptyDrive),1),m,(0,i.createTextVNode)((0,i.toDisplayString)(e.$t("empty-drive-description")),1)])),e.draghover||null==e.folder?(0,i.createCommentVNode)("",!0):((0,i.openBlock)(),(0,i.createBlock)("p",u,(0,i.toDisplayString)(e.$ts.emptyFolder),1))]))],512),e.fetching?((0,i.openBlock)(),(0,i.createBlock)(B,{key:0})):(0,i.createCommentVNode)("",!0)],34),e.draghover?((0,i.openBlock)(),(0,i.createBlock)("div",g)):(0,i.createCommentVNode)("",!0),(0,i.createVNode)("input",{ref:"fileInput",type:"file",accept:"*/*",multiple:"multiple",tabindex:"-1",onChange:t[7]||(t[7]=(...t)=>e.onChangeFileInput&&e.onChangeFileInput(...t))},null,544)])}));var b=o(51436);const y=(0,i.withScopeId)("data-v-487bfa20");(0,i.pushScopeId)("data-v-487bfa20");const F={key:0};(0,i.popScopeId)();const x=y(((e,t,o,r,a,l)=>{const n=(0,i.resolveComponent)("Fa");return(0,i.openBlock)(),(0,i.createBlock)("div",{class:["drylbebk",{draghover:e.draghover}],onClick:t[1]||(t[1]=(...t)=>e.onClick&&e.onClick(...t)),onDragover:t[2]||(t[2]=(0,i.withModifiers)(((...t)=>e.onDragover&&e.onDragover(...t)),["prevent","stop"])),onDragenter:t[3]||(t[3]=(...t)=>e.onDragenter&&e.onDragenter(...t)),onDragleave:t[4]||(t[4]=(...t)=>e.onDragleave&&e.onDragleave(...t)),onDrop:t[5]||(t[5]=(0,i.withModifiers)(((...t)=>e.onDrop&&e.onDrop(...t)),["stop"]))},[null==e.folder?((0,i.openBlock)(),(0,i.createBlock)("i",F,[(0,i.createVNode)(n,{icon:e.faCloud},null,8,["icon"])])):(0,i.createCommentVNode)("",!0),(0,i.createVNode)("span",null,(0,i.toDisplayString)(null==e.folder?e.$ts.drive:e.folder.name),1)],34)}));var D=o(10192);const w=(0,i.defineComponent)({props:{folder:{type:Object,required:!1}},data:()=>({hover:!1,draghover:!1,faCloud:b.uM9}),computed:{browser(){return this.$parent}},methods:{onClick(){this.browser.move(this.folder)},onMouseover(){this.hover=!0},onMouseout(){this.hover=!1},onDragover(e){null==this.folder&&null==this.browser.folder&&(e.dataTransfer.dropEffect="none");const t="file"==e.dataTransfer.items[0].kind,o="mk_drive_file"==e.dataTransfer.types[0],i="mk_drive_folder"==e.dataTransfer.types[0];return e.dataTransfer.dropEffect=t||o||i?"all"==e.dataTransfer.effectAllowed?"copy":"move":"none",!1},onDragenter(){(this.folder||this.browser.folder)&&(this.draghover=!0)},onDragleave(){(this.folder||this.browser.folder)&&(this.draghover=!1)},onDrop(e){if(this.draghover=!1,e.dataTransfer.files.length>0){for(const t of Array.from(e.dataTransfer.files))this.browser.upload(t,this.folder);return}const t=e.dataTransfer.getData("mk_drive_file");if(null!=t&&""!=t){const e=JSON.parse(t);this.browser.removeFile(e.id),D.hi("drive/files/update",{fileId:e.id,folderId:this.folder?this.folder.id:null})}const o=e.dataTransfer.getData("mk_drive_folder");if(null!=o&&""!=o){const e=JSON.parse(o);if(this.folder&&e.id==this.folder.id)return;this.browser.removeFolder(e.id),D.hi("drive/folders/update",{folderId:e.id,parentId:this.folder?this.folder.id:null})}}}});o(81651);w.render=x,w.__scopeId="data-v-487bfa20";const C=w,B=(0,i.withScopeId)("data-v-70632120");(0,i.pushScopeId)("data-v-70632120");const S={class:"name"},$={key:0,class:"upload"};(0,i.popScopeId)();const I=B(((e,t,o,r,a,l)=>{const n=(0,i.resolveComponent)("Fa");return(0,i.openBlock)(),(0,i.createBlock)("div",{class:["rghtznwe",{draghover:e.draghover}],onClick:t[2]||(t[2]=(...t)=>e.onClick&&e.onClick(...t)),onContextmenu:t[3]||(t[3]=(0,i.withModifiers)(((...t)=>e.onContextmenu&&e.onContextmenu(...t)),["stop"])),onMouseover:t[4]||(t[4]=(...t)=>e.onMouseover&&e.onMouseover(...t)),onMouseout:t[5]||(t[5]=(...t)=>e.onMouseout&&e.onMouseout(...t)),onDragover:t[6]||(t[6]=(0,i.withModifiers)(((...t)=>e.onDragover&&e.onDragover(...t)),["prevent","stop"])),onDragenter:t[7]||(t[7]=(0,i.withModifiers)(((...t)=>e.onDragenter&&e.onDragenter(...t)),["prevent"])),onDragleave:t[8]||(t[8]=(...t)=>e.onDragleave&&e.onDragleave(...t)),onDrop:t[9]||(t[9]=(0,i.withModifiers)(((...t)=>e.onDrop&&e.onDrop(...t)),["prevent","stop"])),draggable:"true",onDragstart:t[10]||(t[10]=(...t)=>e.onDragstart&&e.onDragstart(...t)),onDragend:t[11]||(t[11]=(...t)=>e.onDragend&&e.onDragend(...t)),title:e.title},[(0,i.createVNode)("p",S,[e.hover?((0,i.openBlock)(),(0,i.createBlock)(n,{key:0,icon:e.faFolderOpen,"fixed-width":""},null,8,["icon"])):(0,i.createCommentVNode)("",!0),e.hover?(0,i.createCommentVNode)("",!0):((0,i.openBlock)(),(0,i.createBlock)(n,{key:1,icon:e.faFolder,"fixed-width":""},null,8,["icon"])),(0,i.createTextVNode)(" "+(0,i.toDisplayString)(e.folder.name),1)]),e.$store.state.uploadFolder==e.folder.id?((0,i.openBlock)(),(0,i.createBlock)("p",$,(0,i.toDisplayString)(e.$ts.uploadFolder),1)):(0,i.createCommentVNode)("",!0),e.selectMode?((0,i.openBlock)(),(0,i.createBlock)("button",{key:1,class:["checkbox _button",{checked:e.isSelected}],onClick:t[1]||(t[1]=(0,i.withModifiers)(((...t)=>e.checkboxClicked&&e.checkboxClicked(...t)),["prevent","stop"]))},null,2)):(0,i.createCommentVNode)("",!0)],42,["title"])}));var N=o(56024);const z=(0,i.defineComponent)({props:{folder:{type:Object,required:!0},isSelected:{type:Boolean,required:!1,default:!1},selectMode:{type:Boolean,required:!1,default:!1}},emits:["chosen"],data:()=>({hover:!1,draghover:!1,isDragging:!1,faFolder:N.Pk,faFolderOpen:N.cC}),computed:{browser(){return this.$parent},title(){return this.folder.name}},methods:{checkboxClicked(e){this.$emit("chosen",this.folder)},onClick(){this.browser.move(this.folder)},onMouseover(){this.hover=!0},onMouseout(){this.hover=!1},onDragover(e){if(this.isDragging)return void(e.dataTransfer.dropEffect="none");const t="file"==e.dataTransfer.items[0].kind,o="mk_drive_file"==e.dataTransfer.types[0],i="mk_drive_folder"==e.dataTransfer.types[0];e.dataTransfer.dropEffect=t||o||i?"all"==e.dataTransfer.effectAllowed?"copy":"move":"none"},onDragenter(){this.isDragging||(this.draghover=!0)},onDragleave(){this.draghover=!1},onDrop(e){if(this.draghover=!1,e.dataTransfer.files.length>0){for(const t of Array.from(e.dataTransfer.files))this.browser.upload(t,this.folder);return}const t=e.dataTransfer.getData("mk_drive_file");if(null!=t&&""!=t){const e=JSON.parse(t);this.browser.removeFile(e.id),D.hi("drive/files/update",{fileId:e.id,folderId:this.folder.id})}const o=e.dataTransfer.getData("mk_drive_folder");if(null!=o&&""!=o){const e=JSON.parse(o);if(e.id==this.folder.id)return;this.browser.removeFolder(e.id),D.hi("drive/folders/update",{folderId:e.id,parentId:this.folder.id}).then((()=>{})).catch((e=>{switch(e){case"detected-circular-definition":D.WZ({title:this.$ts.unableToProcess,text:this.$ts.circularReferenceFolder});break;default:D.WZ({type:"error",text:this.$ts.somethingHappened})}}))}},onDragstart(e){e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("mk_drive_folder",JSON.stringify(this.folder)),this.isDragging=!0,this.browser.isDragSource=!0},onDragend(){this.isDragging=!1,this.browser.isDragSource=!1},go(){this.browser.move(this.folder.id)},newWindow(){this.browser.newWindow(this.folder)},rename(){D.WZ({title:this.$ts.renameFolder,input:{placeholder:this.$ts.inputNewFolderName,default:this.folder.name}}).then((({canceled:e,result:t})=>{e||D.hi("drive/folders/update",{folderId:this.folder.id,name:t})}))},deleteFolder(){D.hi("drive/folders/delete",{folderId:this.folder.id}).then((()=>{this.$store.state.uploadFolder===this.folder.id&&this.$store.set("uploadFolder",null)})).catch((e=>{switch(e.id){case"b0fc8a17-963c-405d-bfbc-859a487295e1":D.WZ({type:"error",title:this.$ts.unableToDelete,text:this.$ts.hasChildFilesOrFolders});break;default:D.WZ({type:"error",text:this.$ts.unableToDelete})}}))},setAsUploadFolder(){this.$store.set("uploadFolder",this.folder.id)},onContextmenu(e){D.zC([{text:this.$ts.openInWindow,icon:N.wy,action:()=>{D.gk(Promise.all([o.e(1650),o.e(9484)]).then(o.bind(o,69484)),{initialFolder:this.folder},{},"closed")}},null,{text:this.$ts.rename,icon:b.sdN,action:this.rename},null,{text:this.$ts.delete,icon:N.I7,danger:!0,action:this.deleteFolder}],e)}}});o(5172);z.render=I,z.__scopeId="data-v-70632120";const V=z,T=(0,i.withScopeId)("data-v-621adb49");(0,i.pushScopeId)("data-v-621adb49");const M={key:0,class:"label"},_=(0,i.createVNode)("img",{src:"/assets/label.svg"},null,-1),O={key:1,class:"label"},Z=(0,i.createVNode)("img",{src:"/assets/label.svg"},null,-1),A={key:2,class:"label red"},W=(0,i.createVNode)("img",{src:"/assets/label-red.svg"},null,-1),U={class:"name"},j={key:0,class:"ext"};(0,i.popScopeId)();const q=T(((e,t,o,r,a,l)=>{const n=(0,i.resolveComponent)("MkDriveFileThumbnail");return(0,i.openBlock)(),(0,i.createBlock)("div",{class:["ncvczrfv",{isSelected:e.isSelected}],onClick:t[1]||(t[1]=(...t)=>e.onClick&&e.onClick(...t)),onContextmenu:t[2]||(t[2]=(0,i.withModifiers)(((...t)=>e.onContextmenu&&e.onContextmenu(...t)),["stop"])),draggable:"true",onDragstart:t[3]||(t[3]=(...t)=>e.onDragstart&&e.onDragstart(...t)),onDragend:t[4]||(t[4]=(...t)=>e.onDragend&&e.onDragend(...t)),title:e.title},[e.$i.avatarId==e.file.id?((0,i.openBlock)(),(0,i.createBlock)("div",M,[_,(0,i.createVNode)("p",null,(0,i.toDisplayString)(e.$ts.avatar),1)])):(0,i.createCommentVNode)("",!0),e.$i.bannerId==e.file.id?((0,i.openBlock)(),(0,i.createBlock)("div",O,[Z,(0,i.createVNode)("p",null,(0,i.toDisplayString)(e.$ts.banner),1)])):(0,i.createCommentVNode)("",!0),e.file.isSensitive?((0,i.openBlock)(),(0,i.createBlock)("div",A,[W,(0,i.createVNode)("p",null,(0,i.toDisplayString)(e.$ts.nsfw),1)])):(0,i.createCommentVNode)("",!0),(0,i.createVNode)(n,{class:"thumbnail",file:e.file,fit:"contain"},null,8,["file"]),(0,i.createVNode)("p",U,[(0,i.createVNode)("span",null,(0,i.toDisplayString)(-1!=e.file.name.lastIndexOf(".")?e.file.name.substr(0,e.file.name.lastIndexOf(".")):e.file.name),1),-1!=e.file.name.lastIndexOf(".")?((0,i.openBlock)(),(0,i.createBlock)("span",j,(0,i.toDisplayString)(e.file.name.substr(e.file.name.lastIndexOf("."))),1)):(0,i.createCommentVNode)("",!0)])],42,["title"])}));var P=o(70037),L=o(797),E=o(59092);const J=(0,i.defineComponent)({components:{MkDriveFileThumbnail:L.Z},props:{file:{type:Object,required:!0},isSelected:{type:Boolean,required:!1,default:!1},selectMode:{type:Boolean,required:!1,default:!1}},emits:["chosen"],data:()=>({isDragging:!1}),computed:{browser(){return this.$parent},title(){return`${this.file.name}\n${this.file.type} ${(0,E.Z)(this.file.size)}`}},methods:{getMenu(){return[{text:this.$ts.rename,icon:b.sdN,action:this.rename},{text:this.file.isSensitive?this.$ts.unmarkAsSensitive:this.$ts.markAsSensitive,icon:this.file.isSensitive?N.Md:N.Aq,action:this.toggleSensitive},null,{text:this.$ts.copyUrl,icon:b.nNP,action:this.copyUrl},{type:"a",href:this.file.url,target:"_blank",text:this.$ts.download,icon:b.q7m,download:this.file.name},null,{text:this.$ts.delete,icon:b.I7k,danger:!0,action:this.deleteFile}]},onClick(e){this.selectMode?this.$emit("chosen",this.file):D.n4(this.getMenu(),e.currentTarget||e.target)},onContextmenu(e){D.zC(this.getMenu(),e)},onDragstart(e){e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("mk_drive_file",JSON.stringify(this.file)),this.isDragging=!0,this.browser.isDragSource=!0},onDragend(e){this.isDragging=!1,this.browser.isDragSource=!1},rename(){D.WZ({title:this.$ts.renameFile,input:{placeholder:this.$ts.inputNewFileName,default:this.file.name,allowEmpty:!1}}).then((({canceled:e,result:t})=>{e||D.hi("drive/files/update",{fileId:this.file.id,name:t})}))},toggleSensitive(){D.hi("drive/files/update",{fileId:this.file.id,isSensitive:!this.file.isSensitive})},copyUrl(){(0,P.Z)(this.file.url),D.Vp()},setAsAvatar(){D.updateAvatar(this.file)},setAsBanner(){D.updateBanner(this.file)},addApp(){alert("not implemented yet")},async deleteFile(){const{canceled:e}=await D.WZ({type:"warning",text:this.$t("driveFileDeleteConfirm",{name:this.file.name}),showCancelButton:!0});e||D.hi("drive/files/delete",{fileId:this.file.id})},bytes:E.Z}});o(2299);J.render=q,J.__scopeId="data-v-621adb49";const R=J;var X=o(42453);const H=(0,i.defineComponent)({components:{XNavFolder:C,XFolder:V,XFile:R,MkButton:X.Z},props:{initialFolder:{type:Object,required:!1},type:{type:String,required:!1,default:void 0},multiple:{type:Boolean,required:!1,default:!1},select:{type:String,required:!1,default:null}},emits:["selected","change-selection","move-root","cd","open-folder"],data(){return{folder:null,files:[],folders:[],moreFiles:!1,moreFolders:!1,hierarchyFolders:[],selectedFiles:[],selectedFolders:[],uploadings:D.q6,connection:null,draghover:!1,isDragSource:!1,fetching:!0,ilFilesObserver:new IntersectionObserver((e=>e.some((e=>e.isIntersecting))&&!this.fetching&&this.moreFiles&&this.fetchMoreFiles())),moreFilesElement:null,faAngleRight:b.yOZ}},watch:{folder(){this.$emit("cd",this.folder)}},mounted(){this.$store.state.enableInfiniteScroll&&this.$refs.loadMoreFiles&&this.$nextTick((()=>{this.ilFilesObserver.observe(this.$refs.loadMoreFiles.$el)})),this.connection=D.Vw.useSharedConnection("drive"),this.connection.on("fileCreated",this.onStreamDriveFileCreated),this.connection.on("fileUpdated",this.onStreamDriveFileUpdated),this.connection.on("fileDeleted",this.onStreamDriveFileDeleted),this.connection.on("folderCreated",this.onStreamDriveFolderCreated),this.connection.on("folderUpdated",this.onStreamDriveFolderUpdated),this.connection.on("folderDeleted",this.onStreamDriveFolderDeleted),this.initialFolder?this.move(this.initialFolder):this.fetch()},activated(){this.$store.state.enableInfiniteScroll&&this.$nextTick((()=>{this.ilFilesObserver.observe(this.$refs.loadMoreFiles.$el)}))},beforeUnmount(){this.connection.dispose(),this.ilFilesObserver.disconnect()},methods:{onStreamDriveFileCreated(e){this.addFile(e,!0)},onStreamDriveFileUpdated(e){(this.folder?this.folder.id:null)!=e.folderId?this.removeFile(e):this.addFile(e,!0)},onStreamDriveFileDeleted(e){this.removeFile(e)},onStreamDriveFolderCreated(e){this.addFolder(e,!0)},onStreamDriveFolderUpdated(e){(this.folder?this.folder.id:null)!=e.parentId?this.removeFolder(e):this.addFolder(e,!0)},onStreamDriveFolderDeleted(e){this.removeFolder(e)},onDragover(e){if(this.isDragSource)return void(e.dataTransfer.dropEffect="none");const t="file"==e.dataTransfer.items[0].kind,o="mk_drive_file"==e.dataTransfer.types[0],i="mk_drive_folder"==e.dataTransfer.types[0];return e.dataTransfer.dropEffect=t||o||i?"all"==e.dataTransfer.effectAllowed?"copy":"move":"none",!1},onDragenter(e){this.isDragSource||(this.draghover=!0)},onDragleave(e){this.draghover=!1},onDrop(e){if(this.draghover=!1,e.dataTransfer.files.length>0){for(const t of Array.from(e.dataTransfer.files))this.upload(t,this.folder);return}const t=e.dataTransfer.getData("mk_drive_file");if(null!=t&&""!=t){const e=JSON.parse(t);if(this.files.some((t=>t.id==e.id)))return;this.removeFile(e.id),D.hi("drive/files/update",{fileId:e.id,folderId:this.folder?this.folder.id:null})}const o=e.dataTransfer.getData("mk_drive_folder");if(null!=o&&""!=o){const e=JSON.parse(o);if(this.folder&&e.id==this.folder.id)return!1;if(this.folders.some((t=>t.id==e.id)))return!1;this.removeFolder(e.id),D.hi("drive/folders/update",{folderId:e.id,parentId:this.folder?this.folder.id:null}).then((()=>{})).catch((e=>{switch(e){case"detected-circular-definition":D.WZ({title:this.$ts.unableToProcess,text:this.$ts.circularReferenceFolder});break;default:D.WZ({type:"error",text:this.$ts.somethingHappened})}}))}},selectLocalFile(){this.$refs.fileInput.click()},urlUpload(){D.WZ({title:this.$ts.uploadFromUrl,input:{placeholder:this.$ts.uploadFromUrlDescription}}).then((({canceled:e,result:t})=>{e||(D.hi("drive/files/upload_from_url",{url:t,folderId:this.folder?this.folder.id:void 0}),D.WZ({title:this.$ts.uploadFromUrlRequested,text:this.$ts.uploadFromUrlMayTakeTime}))}))},createFolder(){D.WZ({title:this.$ts.createFolder,input:{placeholder:this.$ts.folderName}}).then((({canceled:e,result:t})=>{e||D.hi("drive/folders/create",{name:t,parentId:this.folder?this.folder.id:void 0}).then((e=>{this.addFolder(e,!0)}))}))},renameFolder(e){D.WZ({title:this.$ts.renameFolder,input:{placeholder:this.$ts.inputNewFolderName,default:e.name}}).then((({canceled:t,result:o})=>{t||D.hi("drive/folders/update",{folderId:e.id,name:o}).then((e=>{this.move(e)}))}))},deleteFolder(e){D.hi("drive/folders/delete",{folderId:e.id}).then((()=>{this.move(e.parentId)})).catch((e=>{switch(e.id){case"b0fc8a17-963c-405d-bfbc-859a487295e1":D.WZ({type:"error",title:this.$ts.unableToDelete,text:this.$ts.hasChildFilesOrFolders});break;default:D.WZ({type:"error",text:this.$ts.unableToDelete})}}))},onChangeFileInput(){for(const e of Array.from(this.$refs.fileInput.files))this.upload(e,this.folder)},upload(e,t){t&&"object"==typeof t&&(t=t.id),D.ws(e,t).then((e=>{this.addFile(e,!0)}))},chooseFile(e){const t=this.selectedFiles.some((t=>t.id==e.id));this.multiple?(t?this.selectedFiles=this.selectedFiles.filter((t=>t.id!=e.id)):this.selectedFiles.push(e),this.$emit("change-selection",this.selectedFiles)):t?this.$emit("selected",e):(this.selectedFiles=[e],this.$emit("change-selection",[e]))},chooseFolder(e){const t=this.selectedFolders.some((t=>t.id==e.id));this.multiple?(t?this.selectedFolders=this.selectedFolders.filter((t=>t.id!=e.id)):this.selectedFolders.push(e),this.$emit("change-selection",this.selectedFolders)):t?this.$emit("selected",e):(this.selectedFolders=[e],this.$emit("change-selection",[e]))},move(e){null!=e?("object"==typeof e&&(e=e.id),this.fetching=!0,D.hi("drive/folders/show",{folderId:e}).then((e=>{this.folder=e,this.hierarchyFolders=[];const t=e=>{this.hierarchyFolders.unshift(e),e.parent&&t(e.parent)};e.parent&&t(e.parent),this.$emit("open-folder",e),this.fetch()}))):this.goRoot()},addFolder(e,t=!1){if((this.folder?this.folder.id:null)==e.parentId)if(this.folders.some((t=>t.id==e.id))){const t=this.folders.map((e=>e.id)).indexOf(e.id);this.folders[t]=e}else t?this.folders.unshift(e):this.folders.push(e)},addFile(e,t=!1){if((this.folder?this.folder.id:null)==e.folderId)if(this.files.some((t=>t.id==e.id))){const t=this.files.map((e=>e.id)).indexOf(e.id);this.files[t]=e}else t?this.files.unshift(e):this.files.push(e)},removeFolder(e){"object"==typeof e&&(e=e.id),this.folders=this.folders.filter((t=>t.id!=e))},removeFile(e){"object"==typeof e&&(e=e.id),this.files=this.files.filter((t=>t.id!=e))},appendFile(e){this.addFile(e)},appendFolder(e){this.addFolder(e)},prependFile(e){this.addFile(e,!0)},prependFolder(e){this.addFolder(e,!0)},goRoot(){null!=this.folder&&(this.folder=null,this.hierarchyFolders=[],this.$emit("move-root"),this.fetch())},fetch(){this.folders=[],this.files=[],this.moreFolders=!1,this.moreFiles=!1,this.fetching=!0;let e=null,t=null;D.hi("drive/folders",{folderId:this.folder?this.folder.id:null,limit:31}).then((t=>{31==t.length&&(this.moreFolders=!0,t.pop()),e=t,i()})),D.hi("drive/files",{folderId:this.folder?this.folder.id:null,type:this.type,limit:31}).then((e=>{31==e.length&&(this.moreFiles=!0,e.pop()),t=e,i()}));let o=!1;const i=()=>{if(o){for(const t of e)this.appendFolder(t);for(const e of t)this.appendFile(e);this.fetching=!1}else o=!0}},fetchMoreFiles(){this.fetching=!0;D.hi("drive/files",{folderId:this.folder?this.folder.id:null,type:this.type,untilId:this.files[this.files.length-1].id,limit:31}).then((e=>{31==e.length?(this.moreFiles=!0,e.pop()):this.moreFiles=!1;for(const t of e)this.appendFile(t);this.fetching=!1}))},getMenu(){return[{text:this.$ts.addFile,type:"label"},{text:this.$ts.upload,icon:b.cf$,action:()=>{this.selectLocalFile()}},{text:this.$ts.fromUrl,icon:b.nNP,action:()=>{this.urlUpload()}},null,{text:this.folder?this.folder.name:this.$ts.drive,type:"label"},this.folder?{text:this.$ts.renameFolder,icon:b.sdN,action:()=>{this.renameFolder(this.folder)}}:void 0,this.folder?{text:this.$ts.deleteFolder,icon:N.I7,action:()=>{this.deleteFolder(this.folder)}}:void 0,{text:this.$ts.createFolder,icon:b.x58,action:()=>{this.createFolder()}}]},onContextmenu(e){D.zC(this.getMenu(),e)}}});o(39971);H.render=k,H.__scopeId="data-v-60c142c4";const G=H},21969:(e,t,o)=>{var i=o(99874);"string"==typeof i&&(i=[[e.id,i,""]]),i.locals&&(e.exports=i.locals);(0,o(45346).Z)("907f8486",i,!0,{})},2299:(e,t,o)=>{var i=o(2686);"string"==typeof i&&(i=[[e.id,i,""]]),i.locals&&(e.exports=i.locals);(0,o(45346).Z)("1dbec1bb",i,!0,{})},5172:(e,t,o)=>{var i=o(29671);"string"==typeof i&&(i=[[e.id,i,""]]),i.locals&&(e.exports=i.locals);(0,o(45346).Z)("f3b6dc4a",i,!0,{})},81651:(e,t,o)=>{var i=o(54780);"string"==typeof i&&(i=[[e.id,i,""]]),i.locals&&(e.exports=i.locals);(0,o(45346).Z)("3330044c",i,!0,{})},39971:(e,t,o)=>{var i=o(93259);"string"==typeof i&&(i=[[e.id,i,""]]),i.locals&&(e.exports=i.locals);(0,o(45346).Z)("575356f9",i,!0,{})}}]);