(self.webpackChunkmisskey=self.webpackChunkmisskey||[]).push([[5567],{95915:(e,t,o)=>{var a=o(23645)((function(e){return e[1]}));a.push([e.id,'.note[data-v-2adc438f]{position:relative;transition:box-shadow .1s ease;overflow:hidden;contain:content}.note[data-v-2adc438f]:focus-visible{outline:none}.note[data-v-2adc438f]:focus-visible:after{content:"";pointer-events:none;display:block;position:absolute;z-index:10;top:0;left:0;right:0;bottom:0;margin:auto;width:calc(100% - 8px);height:calc(100% - 8px);border:1px dashed var(--focus);border-radius:var(--radius);box-sizing:border-box}.note:hover>.article>.main>.footer>.button[data-v-2adc438f]{opacity:1}.note>.reply-to[data-v-2adc438f]{opacity:.7;padding-bottom:0}.note>.reply-to-more[data-v-2adc438f]{opacity:.7}.note>.renote[data-v-2adc438f]{display:flex;align-items:center;padding:16px 32px 8px;line-height:28px;white-space:pre;color:var(--renote)}.note>.renote>.avatar[data-v-2adc438f]{flex-shrink:0;display:inline-block;width:28px;height:28px;margin:0 8px 0 0;border-radius:6px}.note>.renote>[data-icon][data-v-2adc438f]{margin-right:4px}.note>.renote>span[data-v-2adc438f]{overflow:hidden;flex-shrink:1;text-overflow:ellipsis;white-space:nowrap}.note>.renote>span>.name[data-v-2adc438f]{font-weight:700}.note>.renote>.info[data-v-2adc438f]{margin-left:auto;font-size:.9em}.note>.renote>.info>.time[data-v-2adc438f]{flex-shrink:0;color:inherit}.note>.renote>.info>.time>.dropdownIcon[data-v-2adc438f]{margin-right:4px}.note>.renote>.info>.visibility[data-v-2adc438f]{margin-left:8px}.note>.renote>.info>.localOnly[data-v-2adc438f]{margin-left:8px}.note>.renote+.article[data-v-2adc438f]{padding-top:8px}.note>.article[data-v-2adc438f]{padding:32px;font-size:1.1em}.note>.article>.header[data-v-2adc438f]{display:flex;position:relative;margin-bottom:16px}.note>.article>.header>.avatar[data-v-2adc438f]{display:block;flex-shrink:0;width:58px;height:58px}.note>.article>.header>.body[data-v-2adc438f]{flex:1;display:flex;flex-direction:column;justify-content:center;padding-left:16px;font-size:.95em}.note>.article>.header>.body>.top>.name[data-v-2adc438f]{font-weight:700}.note>.article>.header>.body>.top>.is-bot[data-v-2adc438f],.note>.article>.header>.body>.top>.is-cat[data-v-2adc438f],.note>.article>.header>.body>.top>.is-lady[data-v-2adc438f]{flex-shrink:0;align-self:center;margin:0 .5em;padding:4px 6px;font-size:80%;border:1px solid var(--divider);border-radius:4px}.note>.article>.header>.body>.top>.admin[data-v-2adc438f],.note>.article>.header>.body>.top>.moderator[data-v-2adc438f]{margin-right:.5em;color:var(--badge)}.note>.article>.main>.body>.cw[data-v-2adc438f]{cursor:default;display:block;margin:0;padding:0;overflow-wrap:break-word}.note>.article>.main>.body>.cw>.text[data-v-2adc438f]{margin-right:8px}.note>.article>.main>.body>.content>.text[data-v-2adc438f]{overflow-wrap:break-word}.note>.article>.main>.body>.content>.text>.reply[data-v-2adc438f]{color:var(--accent);margin-right:.5em}.note>.article>.main>.body>.content>.text>.rp[data-v-2adc438f]{margin-left:4px;font-style:oblique;color:var(--renote)}.note>.article>.main>.body>.content>.url-preview[data-v-2adc438f]{margin-top:8px}.note>.article>.main>.body>.content>.poll[data-v-2adc438f]{font-size:80%}.note>.article>.main>.body>.content>.renote[data-v-2adc438f]{padding:8px 0}.note>.article>.main>.body>.content>.renote>*[data-v-2adc438f]{padding:16px;border:1px dashed var(--renote);border-radius:8px}.note>.article>.main>.body>.channel[data-v-2adc438f]{opacity:.7;font-size:80%}.note>.article>.main>.footer>.info[data-v-2adc438f]{margin:16px 0;opacity:.7;font-size:.9em}.note>.article>.main>.footer>.button[data-v-2adc438f]{margin:0;padding:8px;opacity:.7}.note>.article>.main>.footer>.button[data-v-2adc438f]:not(:last-child){margin-right:28px}.note>.article>.main>.footer>.button[data-v-2adc438f]:hover{color:var(--fgHighlighted)}.note>.article>.main>.footer>.button>.count[data-v-2adc438f]{display:inline;margin:0 0 0 8px;opacity:.7}.note>.article>.main>.footer>.button.reacted[data-v-2adc438f]{color:var(--accent)}.note>.reply[data-v-2adc438f]{border-top:1px solid var(--divider)}.note.max-width_500px[data-v-2adc438f]{font-size:.9em}.note.max-width_450px>.renote[data-v-2adc438f]{padding:8px 16px 0}.note.max-width_450px>.article[data-v-2adc438f]{padding:16px}.note.max-width_450px>.article>.header>.avatar[data-v-2adc438f]{width:50px;height:50px}.note.max-width_350px>.article>.main>.footer>.button[data-v-2adc438f]:not(:last-child){margin-right:18px}.note.max-width_300px[data-v-2adc438f]{font-size:.825em}.note.max-width_300px>.article>.header>.avatar[data-v-2adc438f]{width:50px;height:50px}.note.max-width_300px>.article>.main>.footer>.button[data-v-2adc438f]:not(:last-child){margin-right:12px}.muted[data-v-2adc438f]{padding:8px;text-align:center;opacity:.7}',""]),e.exports=a},25567:(e,t,o)=>{"use strict";o.d(t,{Z:()=>oe});var a=o(55393);const n=(0,a.withScopeId)("data-v-2adc438f");(0,a.pushScopeId)("data-v-2adc438f");const i={key:1,class:"renote"},r={class:"info"},s={key:0,class:"visibility"},c={key:1,class:"localOnly"},l={class:"header"},d={class:"body"},p={class:"top"},h={key:0,class:"is-bot"},u={key:1,class:"is-cat"},m={key:2,class:"is-lady"},f={key:3,class:"admin"},N={key:4,class:"moderator"},v={key:5,class:"visibility"},y={key:6,class:"localOnly"},k={class:"username"},b={class:"main"},x={class:"body"},g={key:0,class:"cw"},B={class:"content"},w={class:"text"},C={key:0,style:{opacity:"0.5"}},$={key:3,class:"rp"},V={key:0,class:"files"},I={key:2,class:"renote"},R={class:"footer"},D={class:"info"},j={key:0,class:"mobile"},_={key:2,class:"count"},M={key:0,class:"count"},O={key:1,class:"button _button"};(0,a.popScopeId)();const A=n(((e,t,o,A,Z,P)=>{const S=(0,a.resolveComponent)("XSub"),E=(0,a.resolveComponent)("MkAvatar"),H=(0,a.resolveComponent)("Fa"),L=(0,a.resolveComponent)("MkUserName"),X=(0,a.resolveComponent)("MkA"),z=(0,a.resolveComponent)("I18n"),T=(0,a.resolveComponent)("MkTime"),U=(0,a.resolveComponent)("MkAcct"),W=(0,a.resolveComponent)("MkInstanceTicker"),F=(0,a.resolveComponent)("Mfm"),q=(0,a.resolveComponent)("XCwButton"),Q=(0,a.resolveComponent)("XMediaList"),J=(0,a.resolveComponent)("XPoll"),K=(0,a.resolveComponent)("MkUrlPreview"),Y=(0,a.resolveComponent)("XNotePreview"),G=(0,a.resolveComponent)("XReactionsViewer"),ee=(0,a.resolveDirective)("user-preview"),te=(0,a.resolveDirective)("hotkey"),oe=(0,a.resolveDirective)("size");return e.muted?((0,a.openBlock)(),(0,a.createBlock)("div",{key:1,class:"_panel muted",onClick:t[9]||(t[9]=t=>e.muted=!1)},[(0,a.createVNode)(z,{src:e.$ts.userSaysSomething,tag:"small"},{name:n((()=>[(0,a.withDirectives)((0,a.createVNode)(X,{class:"name",to:e.userPage(e.appearNote.user)},{default:n((()=>[(0,a.createVNode)(L,{user:e.appearNote.user},null,8,["user"])])),_:1},8,["to"]),[[ee,e.appearNote.userId]])])),_:1},8,["src"])])):(0,a.withDirectives)(((0,a.openBlock)(),(0,a.createBlock)("div",{key:0,class:["note _panel",{renote:e.isRenote}],tabindex:e.isDeleted?null:"-1"},[((0,a.openBlock)(!0),(0,a.createBlock)(a.Fragment,null,(0,a.renderList)(e.conversation,(e=>((0,a.openBlock)(),(0,a.createBlock)(S,{class:"reply-to-more",key:e.id,note:e},null,8,["note"])))),128)),e.appearNote.reply?((0,a.openBlock)(),(0,a.createBlock)(S,{key:0,note:e.appearNote.reply,class:"reply-to"},null,8,["note"])):(0,a.createCommentVNode)("",!0),e.isRenote?((0,a.openBlock)(),(0,a.createBlock)("div",i,[(0,a.createVNode)(E,{class:"avatar",user:e.note.user},null,8,["user"]),(0,a.createVNode)(H,{icon:e.faRetweet},null,8,["icon"]),(0,a.createVNode)(z,{src:e.$ts.renotedBy,tag:"span"},{user:n((()=>[(0,a.withDirectives)((0,a.createVNode)(X,{class:"name",to:e.userPage(e.note.user)},{default:n((()=>[(0,a.createVNode)(L,{user:e.note.user},null,8,["user"])])),_:1},8,["to"]),[[ee,e.note.userId]])])),_:1},8,["src"]),(0,a.createVNode)("div",r,[(0,a.createVNode)("button",{class:"_button time",onClick:t[1]||(t[1]=t=>e.showRenoteMenu()),ref:"renoteTime"},[e.isMyRenote?((0,a.openBlock)(),(0,a.createBlock)(H,{key:0,class:"dropdownIcon",icon:e.faEllipsisH},null,8,["icon"])):(0,a.createCommentVNode)("",!0),(0,a.createVNode)(T,{time:e.note.createdAt},null,8,["time"])],512),"public"!==e.note.visibility?((0,a.openBlock)(),(0,a.createBlock)("span",s,["home"===e.note.visibility?((0,a.openBlock)(),(0,a.createBlock)(H,{key:0,icon:e.faHome},null,8,["icon"])):(0,a.createCommentVNode)("",!0),"followers"===e.note.visibility?((0,a.openBlock)(),(0,a.createBlock)(H,{key:1,icon:e.faUnlock},null,8,["icon"])):(0,a.createCommentVNode)("",!0),"specified"===e.note.visibility?((0,a.openBlock)(),(0,a.createBlock)(H,{key:2,icon:e.faEnvelope},null,8,["icon"])):(0,a.createCommentVNode)("",!0)])):(0,a.createCommentVNode)("",!0),e.note.localOnly?((0,a.openBlock)(),(0,a.createBlock)("span",c,[(0,a.createVNode)(H,{icon:e.faHeart},null,8,["icon"])])):(0,a.createCommentVNode)("",!0)])])):(0,a.createCommentVNode)("",!0),(0,a.createVNode)("article",{class:"article",onContextmenu:t[8]||(t[8]=(0,a.withModifiers)(((...t)=>e.onContextmenu&&e.onContextmenu(...t)),["stop"]))},[(0,a.createVNode)("header",l,[(0,a.createVNode)(E,{class:"avatar",user:e.appearNote.user},null,8,["user"]),(0,a.createVNode)("div",d,[(0,a.createVNode)("div",p,[(0,a.withDirectives)((0,a.createVNode)(X,{class:"name",to:e.userPage(e.appearNote.user)},{default:n((()=>[(0,a.createVNode)(L,{user:e.appearNote.user},null,8,["user"])])),_:1},8,["to"]),[[ee,e.appearNote.user.id]]),e.appearNote.user.isBot?((0,a.openBlock)(),(0,a.createBlock)("span",h,"bot")):(0,a.createCommentVNode)("",!0),e.note.user.isCat?((0,a.openBlock)(),(0,a.createBlock)("span",u,"cat")):(0,a.createCommentVNode)("",!0),e.note.user.isLady?((0,a.openBlock)(),(0,a.createBlock)("span",m,"lady")):(0,a.createCommentVNode)("",!0),e.appearNote.user.isAdmin?((0,a.openBlock)(),(0,a.createBlock)("span",f,[(0,a.createVNode)(H,{icon:e.faBookmark},null,8,["icon"])])):(0,a.createCommentVNode)("",!0),!e.appearNote.user.isAdmin&&e.appearNote.user.isModerator?((0,a.openBlock)(),(0,a.createBlock)("span",N,[(0,a.createVNode)(H,{icon:e.farBookmark},null,8,["icon"])])):(0,a.createCommentVNode)("",!0),"public"!==e.appearNote.visibility?((0,a.openBlock)(),(0,a.createBlock)("span",v,["home"===e.appearNote.visibility?((0,a.openBlock)(),(0,a.createBlock)(H,{key:0,icon:e.faHome},null,8,["icon"])):(0,a.createCommentVNode)("",!0),"followers"===e.appearNote.visibility?((0,a.openBlock)(),(0,a.createBlock)(H,{key:1,icon:e.faUnlock},null,8,["icon"])):(0,a.createCommentVNode)("",!0),"specified"===e.appearNote.visibility?((0,a.openBlock)(),(0,a.createBlock)(H,{key:2,icon:e.faEnvelope},null,8,["icon"])):(0,a.createCommentVNode)("",!0)])):(0,a.createCommentVNode)("",!0),e.appearNote.localOnly?((0,a.openBlock)(),(0,a.createBlock)("span",y,[(0,a.createVNode)(H,{icon:e.faHeart},null,8,["icon"])])):(0,a.createCommentVNode)("",!0)]),(0,a.createVNode)("div",k,[(0,a.createVNode)(U,{user:e.appearNote.user},null,8,["user"])]),e.showTicker?((0,a.openBlock)(),(0,a.createBlock)(W,{key:0,class:"ticker",instance:e.appearNote.user.instance},null,8,["instance"])):(0,a.createCommentVNode)("",!0)])]),(0,a.createVNode)("div",b,[(0,a.createVNode)("div",x,[null!=e.appearNote.cw?((0,a.openBlock)(),(0,a.createBlock)("p",g,[""!=e.appearNote.cw?((0,a.openBlock)(),(0,a.createBlock)(F,{key:0,class:"text",text:e.appearNote.cw,author:e.appearNote.user,i:e.$i,"custom-emojis":e.appearNote.emojis},null,8,["text","author","i","custom-emojis"])):(0,a.createCommentVNode)("",!0),(0,a.createVNode)(q,{value:e.showContent,"onUpdate:value":t[2]||(t[2]=t=>e.showContent=t),note:e.appearNote},null,8,["value","note"])])):(0,a.createCommentVNode)("",!0),(0,a.withDirectives)((0,a.createVNode)("div",B,[(0,a.createVNode)("div",w,[e.appearNote.isHidden?((0,a.openBlock)(),(0,a.createBlock)("span",C,"("+(0,a.toDisplayString)(e.$ts.private)+")",1)):(0,a.createCommentVNode)("",!0),e.appearNote.replyId?((0,a.openBlock)(),(0,a.createBlock)(X,{key:1,class:"reply",to:"/notes/"+e.appearNote.replyId},{default:n((()=>[(0,a.createVNode)(H,{icon:e.faReply},null,8,["icon"])])),_:1},8,["to"])):(0,a.createCommentVNode)("",!0),e.appearNote.text?((0,a.openBlock)(),(0,a.createBlock)(F,{key:2,text:e.appearNote.text,author:e.appearNote.user,i:e.$i,"custom-emojis":e.appearNote.emojis},null,8,["text","author","i","custom-emojis"])):(0,a.createCommentVNode)("",!0),null!=e.appearNote.renote?((0,a.openBlock)(),(0,a.createBlock)("a",$,"RN:")):(0,a.createCommentVNode)("",!0)]),e.appearNote.files.length>0?((0,a.openBlock)(),(0,a.createBlock)("div",V,[(0,a.createVNode)(Q,{"media-list":e.appearNote.files},null,8,["media-list"])])):(0,a.createCommentVNode)("",!0),e.appearNote.poll?((0,a.openBlock)(),(0,a.createBlock)(J,{key:1,note:e.appearNote,ref:"pollViewer",class:"poll"},null,8,["note"])):(0,a.createCommentVNode)("",!0),((0,a.openBlock)(!0),(0,a.createBlock)(a.Fragment,null,(0,a.renderList)(e.urls,(e=>((0,a.openBlock)(),(0,a.createBlock)(K,{url:e,key:e,compact:!0,detail:!0,class:"url-preview"},null,8,["url"])))),128)),e.appearNote.renote?((0,a.openBlock)(),(0,a.createBlock)("div",I,[(0,a.createVNode)(Y,{note:e.appearNote.renote},null,8,["note"])])):(0,a.createCommentVNode)("",!0)],512),[[a.vShow,null==e.appearNote.cw||e.showContent]]),e.appearNote.channel&&!e.inChannel?((0,a.openBlock)(),(0,a.createBlock)(X,{key:1,class:"channel",to:"/channels/"+e.appearNote.channel.id},{default:n((()=>[(0,a.createVNode)(H,{icon:e.faSatelliteDish},null,8,["icon"]),(0,a.createTextVNode)(" "+(0,a.toDisplayString)(e.appearNote.channel.name),1)])),_:1},8,["to"])):(0,a.createCommentVNode)("",!0)]),(0,a.createVNode)("footer",R,[(0,a.createVNode)("div",D,[e.note.viaMobile?((0,a.openBlock)(),(0,a.createBlock)("span",j,[(0,a.createVNode)(H,{icon:e.faMobileAlt},null,8,["icon"])])):(0,a.createCommentVNode)("",!0),(0,a.createVNode)(T,{class:"created-at",time:e.note.createdAt,mode:"detail"},null,8,["time"])]),(0,a.createVNode)(G,{note:e.appearNote,ref:"reactionsViewer"},null,8,["note"]),(0,a.createVNode)("button",{onClick:t[3]||(t[3]=t=>e.reply()),class:"button _button"},[e.appearNote.reply?((0,a.openBlock)(),(0,a.createBlock)(H,{key:0,icon:e.faReplyAll},null,8,["icon"])):((0,a.openBlock)(),(0,a.createBlock)(H,{key:1,icon:e.faReply},null,8,["icon"])),e.appearNote.repliesCount>0?((0,a.openBlock)(),(0,a.createBlock)("p",_,(0,a.toDisplayString)(e.appearNote.repliesCount),1)):(0,a.createCommentVNode)("",!0)]),e.canRenote?((0,a.openBlock)(),(0,a.createBlock)("button",{key:0,onClick:t[4]||(t[4]=t=>e.renote()),class:"button _button",ref:"renoteButton"},[(0,a.createVNode)(H,{icon:e.faRetweet},null,8,["icon"]),e.appearNote.renoteCount>0?((0,a.openBlock)(),(0,a.createBlock)("p",M,(0,a.toDisplayString)(e.appearNote.renoteCount),1)):(0,a.createCommentVNode)("",!0)],512)):((0,a.openBlock)(),(0,a.createBlock)("button",O,[(0,a.createVNode)(H,{icon:e.faBan},null,8,["icon"])])),null==e.appearNote.myReaction?((0,a.openBlock)(),(0,a.createBlock)("button",{key:2,class:"button _button",onClick:t[5]||(t[5]=t=>e.react()),ref:"reactButton"},[(0,a.createVNode)(H,{icon:e.faPlus},null,8,["icon"])],512)):(0,a.createCommentVNode)("",!0),null!=e.appearNote.myReaction?((0,a.openBlock)(),(0,a.createBlock)("button",{key:3,class:"button _button reacted",onClick:t[6]||(t[6]=t=>e.undoReact(e.appearNote)),ref:"reactButton"},[(0,a.createVNode)(H,{icon:e.faMinus},null,8,["icon"])],512)):(0,a.createCommentVNode)("",!0),(0,a.createVNode)("button",{class:"button _button",onClick:t[7]||(t[7]=t=>e.menu()),ref:"menuButton"},[(0,a.createVNode)(H,{icon:e.faEllipsisH},null,8,["icon"])],512)])])],32),((0,a.openBlock)(!0),(0,a.createBlock)(a.Fragment,null,(0,a.renderList)(e.replies,(e=>((0,a.openBlock)(),(0,a.createBlock)(S,{key:e.id,note:e,class:"reply",detail:!0},null,8,["note"])))),128))],10,["tabindex"])),[[a.vShow,!e.isDeleted],[te,e.keymap],[oe,{max:[500,450,350,300]}]])}));var Z=o(51436),P=o(56024),S=o(42984),E=o(25300),H=o(61918),L=o(63111),X=o(20496),z=o(21840),T=o(40798),U=o(14705),W=o(38388),F=o(85651),q=o(3565),Q=o(34862),J=o(70037),K=o(98585),Y=o(55006),G=o(10192),ee=o(73120);!function(...e){for(const t of e)(0,a.markRaw)(t)}(P.Xc,Z.BDt,Z.NBC,Z.Acd,Z.r8p,Z.Kl4,Z.x5v,Z.Lh7,Z.QHR,Z.cNd,Z.J9Y,Z.tAh,Z.FU$,Z.RP7,Z.gPx,Z.m6i,Z.oso,Z.QNf);const te=(0,a.defineComponent)({components:{XSub:H.Z,XNoteHeader:L.Z,XNotePreview:X.Z,XReactionsViewer:z.Z,XMediaList:T.Z,XCwButton:U.Z,XPoll:W.Z,MkUrlPreview:(0,a.defineAsyncComponent)((()=>Promise.all([o.e(1417),o.e(1010)]).then(o.bind(o,71010)))),MkInstanceTicker:(0,a.defineAsyncComponent)((()=>o.e(2666).then(o.bind(o,32666))))},inject:{inChannel:{default:null}},props:{note:{type:Object,required:!0}},emits:["update:note"],data:()=>({connection:null,conversation:[],replies:[],showContent:!1,isDeleted:!1,muted:!1,faEdit:P.Xc,faBolt:Z.BDt,faTimes:Z.NBC,faBullhorn:Z.Acd,faPlus:Z.r8p,faMinus:Z.Kl4,faRetweet:Z.x5v,faReply:Z.Lh7,faReplyAll:Z.QHR,faEllipsisH:Z.cNd,faHome:Z.J9Y,faUnlock:Z.tAh,faEnvelope:Z.FU$,faThumbtack:Z.RP7,faBan:Z.gPx,faHeart:Z.m6i,faPlug:Z.oso,faSatelliteDish:Z.QNf}),computed:{rs(){return this.$store.state.reactions},keymap(){return{r:()=>this.reply(!0),"e|a|plus":()=>this.react(!0),q:()=>this.renote(!0),"f|b":this.favorite,"delete|ctrl+d":this.del,"ctrl+q":this.renoteDirectly,"up|k|shift+tab":this.focusBefore,"down|j|tab":this.focusAfter,esc:this.blur,"m|o":()=>this.menu(!0),s:this.toggleShowContent,1:()=>this.reactDirectly(this.rs[0]),2:()=>this.reactDirectly(this.rs[1]),3:()=>this.reactDirectly(this.rs[2]),4:()=>this.reactDirectly(this.rs[3]),5:()=>this.reactDirectly(this.rs[4]),6:()=>this.reactDirectly(this.rs[5]),7:()=>this.reactDirectly(this.rs[6]),8:()=>this.reactDirectly(this.rs[7]),9:()=>this.reactDirectly(this.rs[8]),0:()=>this.reactDirectly(this.rs[9])}},isRenote(){return this.note.renote&&null==this.note.text&&0==this.note.fileIds.length&&null==this.note.poll},appearNote(){return this.isRenote?this.note.renote:this.note},isMyNote(){return this.$i&&this.$i.id===this.appearNote.userId},isMyRenote(){return this.$i&&this.$i.id===this.note.userId},canRenote(){return["public","home"].includes(this.appearNote.visibility)||this.isMyNote},reactionsCount(){return this.appearNote.reactions?(0,E.Sm)(Object.values(this.appearNote.reactions)):0},urls(){if(this.appearNote.text){const e=(0,S.Q)(this.appearNote.text),t=(0,E.Tw)(e.filter((e=>("url"==e.node.type||"link"==e.node.type)&&e.node.props.url&&!e.node.props.silent)).map((e=>e.node.props.url))),o=e=>e.replace(/#[^#]*$/,"");return t.reduce(((e,t)=>{const a=o(t);return e.map((e=>o(e))).includes(a)||e.push(t),e}),[])}return null},showTicker(){return"always"===this.$store.state.instanceTicker||!("remote"!==this.$store.state.instanceTicker||!this.appearNote.user.instance)}},async created(){if(this.$i&&(this.connection=G.Vw),this.muted=await(0,K.O)(this.appearNote,this.$i,this.$store.state.mutedWords),ee.n$.length>0){let e=this.note;for(const t of ee.n$)e=await t.handler(JSON.parse(JSON.stringify(e)));this.$emit("update:note",Object.freeze(e))}G.hi("notes/children",{noteId:this.appearNote.id,limit:30}).then((e=>{this.replies=e})),this.appearNote.replyId&&G.hi("notes/conversation",{noteId:this.appearNote.replyId}).then((e=>{this.conversation=e.reverse()}))},mounted(){this.capture(!0),this.$i&&this.connection.on("_connected_",this.onStreamConnected)},beforeUnmount(){this.decapture(!0),this.$i&&this.connection.off("_connected_",this.onStreamConnected)},methods:{updateAppearNote(e){this.$emit("update:note",Object.freeze(this.isRenote?Object.assign(Object.assign({},this.note),{renote:Object.assign(Object.assign({},this.note.renote),e)}):Object.assign(Object.assign({},this.note),e)))},readPromo(){G.hi("promo/read",{noteId:this.appearNote.id}),this.isDeleted=!0},capture(e=!1){this.$i&&(this.connection.send(document.body.contains(this.$el)?"sn":"s",{id:this.appearNote.id}),e&&this.connection.on("noteUpdated",this.onStreamNoteUpdated))},decapture(e=!1){this.$i&&(this.connection.send("un",{id:this.appearNote.id}),e&&this.connection.off("noteUpdated",this.onStreamNoteUpdated))},onStreamConnected(){this.capture()},onStreamNoteUpdated(e){const{type:t,id:o,body:a}=e;if(o===this.appearNote.id)switch(t){case"reacted":{const e=a.reaction;let t=Object.assign({},this.appearNote);if(a.emoji){const e=this.appearNote.emojis||[];e.includes(a.emoji)||(t.emojis=[...e,a.emoji])}const o=(this.appearNote.reactions||{})[e]||0;t.reactions=Object.assign(Object.assign({},this.appearNote.reactions),{[e]:o+1}),a.userId===this.$i.id&&(t.myReaction=e),this.updateAppearNote(t);break}case"unreacted":{const e=a.reaction;let t=Object.assign({},this.appearNote);const o=(this.appearNote.reactions||{})[e]||0;t.reactions=Object.assign(Object.assign({},this.appearNote.reactions),{[e]:Math.max(0,o-1)}),a.userId===this.$i.id&&(t.myReaction=null),this.updateAppearNote(t);break}case"pollVoted":{const e=a.choice;let t=Object.assign({},this.appearNote);const o=[...this.appearNote.poll.choices];o[e]=Object.assign(Object.assign(Object.assign({},o[e]),{votes:o[e].votes+1}),a.userId===this.$i.id?{isVoted:!0}:{}),t.poll=Object.assign(Object.assign({},this.appearNote.poll),{choices:o}),this.updateAppearNote(t);break}case"deleted":this.isDeleted=!0}},reply(e=!1){(0,F.o)(),G.v_({reply:this.appearNote,animation:!e},(()=>{this.focus()}))},renote(e=!1){(0,F.o)(),this.blur(),G.n4([{text:this.$ts.renote,icon:Z.x5v,action:()=>{G.hi("notes/create",{renoteId:this.appearNote.id})}},{text:this.$ts.quote,icon:Z.Elr,action:()=>{G.v_({renote:this.appearNote})}}],this.$refs.renoteButton,{viaKeyboard:e})},renoteDirectly(){G.Zv("notes/create",{renoteId:this.appearNote.id},void 0,(e=>{G.WZ({type:"success",text:this.$ts.renoted})}),(e=>{"b5c90186-4ab0-49c8-9bba-a1f76c282ba4"===e.id?G.WZ({type:"error",text:this.$ts.cantRenote}):"fd4cc33e-2a37-48dd-99cc-9b806eb2031a"===e.id&&G.WZ({type:"error",text:this.$ts.cantReRenote})}))},react(e=!1){(0,F.o)(),this.blur(),G.gk(Promise.all([o.e(9411),o.e(9059)]).then(o.bind(o,9059)),{src:this.$refs.reactButton,asReactionPicker:!0},{done:e=>{e&&G.hi("notes/reactions/create",{noteId:this.appearNote.id,reaction:e}),this.focus()}},"closed")},reactDirectly(e){G.hi("notes/reactions/create",{noteId:this.appearNote.id,reaction:e})},undoReact(e){e.myReaction&&G.hi("notes/reactions/delete",{noteId:e.id})},favorite(){(0,F.o)(),G.Zv("notes/favorites/create",{noteId:this.appearNote.id},void 0,(e=>{G.WZ({type:"success",text:this.$ts.favorited})}),(e=>{"a402c12b-34dd-41d2-97d8-4d2ffd96a1a6"===e.id?G.WZ({type:"error",text:this.$ts.alreadyFavorited}):"6dd26674-e060-4816-909a-45ba3f4da458"===e.id&&G.WZ({type:"error",text:this.$ts.cantFavorite})}))},del(){G.WZ({type:"warning",text:this.$ts.noteDeleteConfirm,showCancelButton:!0}).then((({canceled:e})=>{e||G.hi("notes/delete",{noteId:this.appearNote.id})}))},delEdit(){G.WZ({type:"warning",text:this.$ts.deleteAndEditConfirm,showCancelButton:!0}).then((({canceled:e})=>{e||(G.hi("notes/delete",{noteId:this.appearNote.id}),G.v_({initialNote:this.appearNote,renote:this.appearNote.renote,reply:this.appearNote.reply,channel:this.appearNote.channel}))}))},toggleFavorite(e){G.Zv(e?"notes/favorites/create":"notes/favorites/delete",{noteId:this.appearNote.id})},toggleWatch(e){G.Zv(e?"notes/watching/create":"notes/watching/delete",{noteId:this.appearNote.id})},getMenu(){let e;if(this.$i){const t=G.hi("notes/state",{noteId:this.appearNote.id});e=[{icon:P.kZ,text:this.$ts.copyContent,action:this.copyContent},{icon:Z.nNP,text:this.$ts.copyLink,action:this.copyLink},this.appearNote.url||this.appearNote.uri?{icon:Z.cyx,text:this.$ts.showOnRemote,action:()=>{window.open(this.appearNote.url||this.appearNote.uri,"_blank")}}:void 0,null,t.then((e=>e.isFavorited?{icon:Z.Tab,text:this.$ts.unfavorite,action:()=>this.toggleFavorite(!1)}:{icon:Z.Tab,text:this.$ts.favorite,action:()=>this.toggleFavorite(!0)})),{icon:Z.Alc,text:this.$ts.clip,action:()=>this.clip()},this.appearNote.userId!=this.$i.id?t.then((e=>e.isWatching?{icon:P.Aq,text:this.$ts.unwatch,action:()=>this.toggleWatch(!1)}:{icon:P.Md,text:this.$ts.watch,action:()=>this.toggleWatch(!0)})):void 0,this.appearNote.userId==this.$i.id?(this.$i.pinnedNoteIds||[]).includes(this.appearNote.id)?{icon:Z.RP7,text:this.$ts.unpin,action:()=>this.togglePin(!1)}:{icon:Z.RP7,text:this.$ts.pin,action:()=>this.togglePin(!0)}:void 0,...this.$i.isModerator||this.$i.isAdmin?[null,{icon:Z.Acd,text:this.$ts.promote,action:this.promote}]:[],...this.appearNote.userId!=this.$i.id?[null,{icon:Z.RLE,text:this.$ts.reportAbuse,action:()=>{const e=`${Q.HQ}/notes/${this.appearNote.id}`;G.gk(Promise.all([o.e(1650),o.e(4652)]).then(o.bind(o,44652)),{user:this.appearNote.user,initialComment:`Note: ${e}\n-----\n`},{},"closed")}}]:[],...this.appearNote.userId==this.$i.id||this.$i.isModerator||this.$i.isAdmin?[null,this.appearNote.userId==this.$i.id?{icon:P.Xc,text:this.$ts.deleteAndEdit,action:this.delEdit}:void 0,{icon:P.I7,text:this.$ts.delete,danger:!0,action:this.del}]:[]].filter((e=>void 0!==e))}else e=[{icon:P.kZ,text:this.$ts.copyContent,action:this.copyContent},{icon:Z.nNP,text:this.$ts.copyLink,action:this.copyLink},this.appearNote.url||this.appearNote.uri?{icon:Z.cyx,text:this.$ts.showOnRemote,action:()=>{window.open(this.appearNote.url||this.appearNote.uri,"_blank")}}:void 0].filter((e=>void 0!==e));return ee.aJ.length>0&&(e=e.concat([null,...ee.aJ.map((e=>({icon:Z.oso,text:e.title,action:()=>{e.handler(this.appearNote)}})))])),e},onContextmenu(e){const t=e=>"A"===e.tagName||(e.parentElement?t(e.parentElement):void 0);t(e.target)||""===window.getSelection().toString()&&(this.$store.state.useReactionPickerForContextMenu?(e.preventDefault(),this.react()):G.zC(this.getMenu(),e).then(this.focus))},menu(e=!1){G.n4(this.getMenu(),this.$refs.menuButton,{viaKeyboard:e}).then(this.focus)},showRenoteMenu(e=!1){this.isMyRenote&&G.n4([{text:this.$ts.unrenote,icon:P.I7,danger:!0,action:()=>{G.hi("notes/delete",{noteId:this.note.id}),this.isDeleted=!0}}],this.$refs.renoteTime,{viaKeyboard:e})},toggleShowContent(){this.showContent=!this.showContent},copyContent(){(0,J.Z)(this.appearNote.text),G.Vp()},copyLink(){(0,J.Z)(`${Q.HQ}/notes/${this.appearNote.id}`),G.Vp()},togglePin(e){G.Zv(e?"i/pin":"i/unpin",{noteId:this.appearNote.id},void 0,null,(e=>{"72dab508-c64d-498f-8740-a8eec1ba385a"===e.id&&G.WZ({type:"error",text:this.$ts.pinLimitExceeded})}))},async clip(){const e=await G.hi("clips/list");G.n4([{icon:Z.r8p,text:this.$ts.createNew,action:async()=>{const{canceled:e,result:t}=await G.cr(this.$ts.createNewClip,{name:{type:"string",label:this.$ts.name},description:{type:"string",required:!1,multiline:!0,label:this.$ts.description},isPublic:{type:"boolean",label:this.$ts.public,default:!1}});if(e)return;const o=await G.Zv("clips/create",t);G.Zv("clips/add-note",{clipId:o.id,noteId:this.appearNote.id})}},null,...e.map((e=>({text:e.name,action:()=>{G.Zv("clips/add-note",{clipId:e.id,noteId:this.appearNote.id})}})))],this.$refs.menuButton,{}).then(this.focus)},async promote(){const{canceled:e,result:t}=await G.WZ({title:this.$ts.numberOfDays,input:{type:"number"}});e||G.Zv("admin/promo/create",{noteId:this.appearNote.id,expiresAt:Date.now()+864e5*t})},focus(){this.$el.focus()},blur(){this.$el.blur()},focusBefore(){(0,q.r)(this.$el)},focusAfter(){(0,q.s)(this.$el)},userPage:Y.tL}});o(45526);te.render=A,te.__scopeId="data-v-2adc438f";const oe=te},45526:(e,t,o)=>{var a=o(95915);"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);(0,o(45346).Z)("0fce475d",a,!0,{})}}]);