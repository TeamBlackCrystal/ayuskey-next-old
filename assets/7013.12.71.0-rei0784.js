(self.webpackChunkmisskey=self.webpackChunkmisskey||[]).push([[7013,891],{60891:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>m});var s=o(55393);const n={class:"_section"},c={class:"_title"},a={class:"_content"},i={class:"id"},l={class:"description"},r={class:"_content"},p={class:"_footer"};var d=o(42453),k=o(10192);const h=(0,s.defineComponent)({components:{MkButton:d.Z},props:["session"],computed:{name(){const e=document.createElement("div");return e.textContent=this.app.name,e.innerHTML},app(){return this.session.app}},methods:{cancel(){k.hi("auth/deny",{token:this.session.token}).then((()=>{this.$emit("denied")}))},accept(){k.hi("auth/accept",{token:this.session.token}).then((()=>{this.$emit("accepted")}))}}});h.render=function(e,t,o,d,k,h){const m=(0,s.resolveComponent)("MkButton");return(0,s.openBlock)(),(0,s.createBlock)("section",n,[(0,s.createVNode)("div",c,(0,s.toDisplayString)(e.$t("_auth.shareAccess",{name:e.app.name})),1),(0,s.createVNode)("div",a,[(0,s.createVNode)("h2",null,(0,s.toDisplayString)(e.app.name),1),(0,s.createVNode)("p",i,(0,s.toDisplayString)(e.app.id),1),(0,s.createVNode)("p",l,(0,s.toDisplayString)(e.app.description),1)]),(0,s.createVNode)("div",r,[(0,s.createVNode)("h2",null,(0,s.toDisplayString)(e.$ts._auth.permissionAsk),1),(0,s.createVNode)("ul",null,[((0,s.openBlock)(!0),(0,s.createBlock)(s.Fragment,null,(0,s.renderList)(e.app.permission,(t=>((0,s.openBlock)(),(0,s.createBlock)("li",{key:t},(0,s.toDisplayString)(e.$t("_permissions."+t)),1)))),128))])]),(0,s.createVNode)("div",p,[(0,s.createVNode)(m,{onClick:e.cancel,inline:""},{default:(0,s.withCtx)((()=>[(0,s.createTextVNode)((0,s.toDisplayString)(e.$ts.cancel),1)])),_:1},8,["onClick"]),(0,s.createVNode)(m,{onClick:e.accept,inline:"",primary:""},{default:(0,s.withCtx)((()=>[(0,s.createTextVNode)((0,s.toDisplayString)(e.$ts.accept),1)])),_:1},8,["onClick"])])])};const m=h},87013:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>N});var s=o(55393);const n=(0,s.withScopeId)("data-v-075a7452");(0,s.pushScopeId)("data-v-075a7452");const c={key:0,class:""},a={key:1},i={key:1,class:"denied"},l={key:2,class:"accepted"},r={key:0},p={key:1},d={key:3,class:"error"},k={key:2,class:"signin"};(0,s.popScopeId)();const h=n(((e,t,o,n,h,m)=>{const u=(0,s.resolveComponent)("MkLoading"),g=(0,s.resolveComponent)("XForm"),y=(0,s.resolveComponent)("MkEllipsis"),B=(0,s.resolveComponent)("MkSignin");return e.$i&&e.fetching?((0,s.openBlock)(),(0,s.createBlock)("div",c,[(0,s.createVNode)(u)])):e.$i?((0,s.openBlock)(),(0,s.createBlock)("div",a,["waiting"==e.state?((0,s.openBlock)(),(0,s.createBlock)(g,{key:0,class:"form",ref:"form",session:e.session,onDenied:t[1]||(t[1]=t=>e.state="denied"),onAccepted:e.accepted},null,8,["session","onAccepted"])):(0,s.createCommentVNode)("",!0),"denied"==e.state?((0,s.openBlock)(),(0,s.createBlock)("div",i,[(0,s.createVNode)("h1",null,(0,s.toDisplayString)(e.$ts._auth.denied),1)])):(0,s.createCommentVNode)("",!0),"accepted"==e.state?((0,s.openBlock)(),(0,s.createBlock)("div",l,[(0,s.createVNode)("h1",null,(0,s.toDisplayString)(e.session.app.isAuthorized?(void 0).$t("already-authorized"):(void 0).$ts.allowed),1),e.session.app.callbackUrl?((0,s.openBlock)(),(0,s.createBlock)("p",r,[(0,s.createTextVNode)((0,s.toDisplayString)(e.$ts._auth.callback),1),(0,s.createVNode)(y)])):(0,s.createCommentVNode)("",!0),e.session.app.callbackUrl?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createBlock)("p",p,(0,s.toDisplayString)(e.$ts._auth.pleaseGoBack),1))])):(0,s.createCommentVNode)("",!0),"fetch-session-error"==e.state?((0,s.openBlock)(),(0,s.createBlock)("div",d,[(0,s.createVNode)("p",null,(0,s.toDisplayString)(e.$ts.somethingHappened),1)])):(0,s.createCommentVNode)("",!0)])):((0,s.openBlock)(),(0,s.createBlock)("div",k,[(0,s.createVNode)(B,{onLogin:e.onLogin},null,8,["onLogin"])]))}));var m=o(60891),u=o(92254),g=o(10192),y=o(37200);const B=(0,s.defineComponent)({components:{XForm:m.default,MkSignin:u.Z},data:()=>({state:null,session:null,fetching:!0}),computed:{token(){return this.$route.params.token}},mounted(){this.$i&&g.hi("auth/session/show",{token:this.token}).then((e=>{this.session=e,this.fetching=!1,this.session.app.isAuthorized?g.hi("auth/accept",{token:this.session.token}).then((()=>{this.accepted()})):this.state="waiting"})).catch((e=>{this.state="fetch-session-error",this.fetching=!1}))},methods:{accepted(){this.state="accepted",this.session.app.callbackUrl&&(location.href=`${this.session.app.callbackUrl}?token=${this.session.token}`)},onLogin(e){(0,y.x4)(e.i)}}});B.render=h,B.__scopeId="data-v-075a7452";const N=B}}]);