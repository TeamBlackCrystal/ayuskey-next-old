(self.webpackChunkmisskey=self.webpackChunkmisskey||[]).push([[8217],{62960:(e,t,i)=>{var a=i(23645)((function(e){return e[1]}));a.push([e.id,".container-toggle-enter-active[data-v-1dbdaf33],.container-toggle-leave-active[data-v-1dbdaf33]{overflow-y:hidden;transition:opacity .5s,height .5s!important}.container-toggle-enter-from[data-v-1dbdaf33],.container-toggle-leave-to[data-v-1dbdaf33]{opacity:0}.ukygtjoj[data-v-1dbdaf33]{position:relative;overflow:hidden}.ukygtjoj.naked[data-v-1dbdaf33]{background:transparent!important;box-shadow:none!important}.ukygtjoj.scrollable[data-v-1dbdaf33]{display:flex;flex-direction:column}.ukygtjoj.scrollable>div[data-v-1dbdaf33]{overflow:auto}.ukygtjoj>header[data-v-1dbdaf33]{position:relative;color:var(--panelHeaderFg);background:var(--panelHeaderBg);box-shadow:0 1px 0 0 var(--panelHeaderDivider);z-index:2;line-height:1.4em}.ukygtjoj>header>.title[data-v-1dbdaf33]{margin:0;padding:12px 16px}.ukygtjoj>header>.title[data-v-1dbdaf33]> [data-icon]{margin-right:6px}.ukygtjoj>header>.title[data-v-1dbdaf33]:empty{display:none}.ukygtjoj>header>.sub[data-v-1dbdaf33]{position:absolute;z-index:2;top:0;right:0;height:100%}.ukygtjoj>header>.sub[data-v-1dbdaf33]> button{width:42px;height:100%}.ukygtjoj>div[data-v-1dbdaf33]> ._content{padding:24px}.ukygtjoj>div[data-v-1dbdaf33]> ._content+._content{border-top:1px solid var(--divider)}.ukygtjoj.max-width_380px>header>.title[data-v-1dbdaf33]{padding:8px 10px;font-size:.9em}.ukygtjoj.max-width_380px>div[data-v-1dbdaf33]> ._content{padding:16px}._forceContainerFull_ .ukygtjoj>header>.title[data-v-1dbdaf33]{padding:12px 16px!important}._forceContainerFull_.ukygtjoj>header>.title[data-v-1dbdaf33]{padding:12px 16px!important}",""]),e.exports=a},32734:(e,t,i)=>{var a=i(23645)((function(e){return e[1]}));a.push([e.id,".iltifgqe[data-v-2cffdb2f]{padding:16px}.iltifgqe>.editor[data-v-2cffdb2f]{position:relative}.bepmlvbi[data-v-2cffdb2f]{padding:16px}.bepmlvbi>.log[data-v-2cffdb2f]:not(.print){opacity:.7}",""]),e.exports=a},31064:(e,t,i)=>{"use strict";i.d(t,{a:()=>s});var a=i(27328),o=i(10192),n=i(37200);function s(e){let t=0;return{USER_ID:n.$i?a.values.STR(n.$i.id):a.values.NULL,USER_NAME:n.$i?a.values.STR(n.$i.name):a.values.NULL,USER_USERNAME:n.$i?a.values.STR(n.$i.username):a.values.NULL,"Mk:dialog":a.values.FN_NATIVE((async([e,t,i])=>{await o.WZ({type:i?i.value:"info",title:e.value,text:t.value})})),"Mk:confirm":a.values.FN_NATIVE((async([e,t,i])=>(await o.WZ({type:i?i.value:"question",showCancelButton:!0,title:e.value,text:t.value})).canceled?a.values.FALSE:a.values.TRUE)),"Mk:api":a.values.FN_NATIVE((async([i,n,s])=>{if(s&&a.utils.assertString(s),t++,t>16)return a.values.NULL;const r=await o.hi(i.value,a.utils.valToJs(n),s?s.value:e.token||null);return a.utils.jsToVal(r)})),"Mk:save":a.values.FN_NATIVE((([t,i])=>(a.utils.assertString(t),localStorage.setItem("aiscript:"+e.storageKey+":"+t.value,JSON.stringify(a.utils.valToJs(i))),a.values.NULL))),"Mk:load":a.values.FN_NATIVE((([t])=>(a.utils.assertString(t),a.utils.jsToVal(JSON.parse(localStorage.getItem("aiscript:"+e.storageKey+":"+t.value))))))}}},69146:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var a=i(55393);const o=(0,a.withScopeId)("data-v-1dbdaf33");(0,a.pushScopeId)("data-v-1dbdaf33");const n={key:0,ref:"header"},s={class:"title"},r={class:"sub"};(0,a.popScopeId)();const l=o(((e,t,i,l,d,c)=>{const h=(0,a.resolveComponent)("Fa"),u=(0,a.resolveDirective)("size");return(0,a.withDirectives)(((0,a.openBlock)(),(0,a.createBlock)("div",{class:["ukygtjoj _panel",{naked:e.naked,hideHeader:!e.showHeader,scrollable:e.scrollable,closed:!e.showBody}]},[e.showHeader?((0,a.openBlock)(),(0,a.createBlock)("header",n,[(0,a.createVNode)("div",s,[(0,a.renderSlot)(e.$slots,"header")]),(0,a.createVNode)("div",r,[(0,a.renderSlot)(e.$slots,"func"),e.bodyTogglable?((0,a.openBlock)(),(0,a.createBlock)("button",{key:0,class:"_button",onClick:t[1]||(t[1]=()=>e.showBody=!e.showBody)},[e.showBody?((0,a.openBlock)(),(0,a.createBlock)(h,{key:0,icon:e.faAngleUp},null,8,["icon"])):((0,a.openBlock)(),(0,a.createBlock)(h,{key:1,icon:e.faAngleDown},null,8,["icon"]))])):(0,a.createCommentVNode)("",!0)])],512)):(0,a.createCommentVNode)("",!0),(0,a.createVNode)(a.Transition,{name:"container-toggle",onEnter:e.enter,onAfterEnter:e.afterEnter,onLeave:e.leave,onAfterLeave:e.afterLeave},{default:o((()=>[(0,a.withDirectives)((0,a.createVNode)("div",null,[(0,a.renderSlot)(e.$slots,"default")],512),[[a.vShow,e.showBody]])])),_:3},8,["onEnter","onAfterEnter","onLeave","onAfterLeave"])],2)),[[u,{max:[380]}]])}));var d=i(51436);const c=(0,a.defineComponent)({props:{showHeader:{type:Boolean,required:!1,default:!0},naked:{type:Boolean,required:!1,default:!1},bodyTogglable:{type:Boolean,required:!1,default:!1},expanded:{type:Boolean,required:!1,default:!0},scrollable:{type:Boolean,required:!1,default:!1}},data(){return{showBody:this.expanded,faAngleUp:d.onQ,faAngleDown:d.gc2}},mounted(){this.$watch("showBody",(e=>{const t=this.showHeader?this.$refs.header.offsetHeight:0;this.$el.style.minHeight=t+"px",this.$el.style.flexBasis=e?"auto":t+"px"}),{immediate:!0})},methods:{toggleContent(e){this.bodyTogglable&&(this.showBody=e)},enter(e){const t=e.getBoundingClientRect().height;e.style.height=0,e.offsetHeight,e.style.height=t+"px"},afterEnter(e){e.style.height=null},leave(e){const t=e.getBoundingClientRect().height;e.style.height=t+"px",e.offsetHeight,e.style.height=0},afterLeave(e){e.style.height=null}}});i(64935);c.render=l,c.__scopeId="data-v-1dbdaf33";const h=c},60609:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>x});var a=i(55393);const o=(0,a.withScopeId)("data-v-2cffdb2f");(0,a.pushScopeId)("data-v-2cffdb2f");const n={class:"iltifgqe"},s={class:"editor _panel _vMargin"},r={class:"bepmlvbi"},l={class:"_vMargin"};(0,a.popScopeId)();const d=o(((e,t,i,d,c,h)=>{const u=(0,a.resolveComponent)("PrismEditor"),p=(0,a.resolveComponent)("Fa"),f=(0,a.resolveComponent)("MkButton"),g=(0,a.resolveComponent)("MkContainer");return(0,a.openBlock)(),(0,a.createBlock)("div",n,[(0,a.createVNode)("div",s,[(0,a.createVNode)(u,{class:"_code code",modelValue:e.code,"onUpdate:modelValue":t[1]||(t[1]=t=>e.code=t),highlight:e.highlighter,"line-numbers":!1},null,8,["modelValue","highlight"]),(0,a.createVNode)(f,{style:{position:"absolute",top:"8px",right:"8px"},onClick:t[2]||(t[2]=t=>e.run()),primary:""},{default:o((()=>[(0,a.createVNode)(p,{icon:e.faPlay},null,8,["icon"])])),_:1})]),(0,a.createVNode)(g,{"body-togglable":!0,class:"_vMargin"},{header:o((()=>[(0,a.createVNode)(p,{"fixed-width":""}),(0,a.createTextVNode)((0,a.toDisplayString)(e.$ts.output),1)])),default:o((()=>[(0,a.createVNode)("div",r,[((0,a.openBlock)(!0),(0,a.createBlock)(a.Fragment,null,(0,a.renderList)(e.logs,(e=>((0,a.openBlock)(),(0,a.createBlock)("div",{class:["log",{print:e.print}],key:e.id},(0,a.toDisplayString)(e.text),3)))),128))])])),_:1}),(0,a.createVNode)("div",l,(0,a.toDisplayString)(e.$ts.scratchpadDescription),1)])}));var c=i(51436),h=(i(15660),i(28325));i(35433),i(39980),i(80194);function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}var p="undefined"!=typeof window&&navigator&&/Win/i.test(navigator.platform),f="undefined"!=typeof window&&navigator&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),g=(0,a.defineComponent)({props:{lineNumbers:{type:Boolean,default:!1},autoStyleLineNumbers:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1},modelValue:{type:String,default:""},highlight:{type:Function,required:!0},tabSize:{type:Number,default:2},insertSpaces:{type:Boolean,default:!0},ignoreTabKey:{type:Boolean,default:!1},placeholder:{type:String,default:""}},data:function(){return{capture:!0,history:{stack:[],offset:-1},lineNumbersHeight:"20px",codeData:""}},watch:{modelValue:{immediate:!0,handler:function(e){this.codeData=e||""}},content:{immediate:!0,handler:function(){var e=this;this.lineNumbers&&this.$nextTick((function(){e.setLineNumbersHeight()}))}},lineNumbers:function(){var e=this;this.$nextTick((function(){e.styleLineNumbers(),e.setLineNumbersHeight()}))}},computed:{isEmpty:function(){return 0===this.codeData.length},content:function(){return this.highlight(this.codeData)+"<br />"},lineNumbersCount:function(){return this.codeData.split(/\r\n|\n/).length}},mounted:function(){this._recordCurrentState(),this.styleLineNumbers()},methods:{setLineNumbersHeight:function(){this.lineNumbersHeight=getComputedStyle(this.$refs.pre).height},styleLineNumbers:function(){if(this.lineNumbers&&this.autoStyleLineNumbers){var e=this.$refs.pre,t=this.$el.querySelector(".prism-editor__line-numbers"),i=window.getComputedStyle(e);this.$nextTick((function(){var a="border-top-left-radius",o="border-bottom-left-radius";if(t){t.style[a]=i[a],t.style[o]=i[o],e.style[a]="0",e.style[o]="0";["background-color","margin-top","padding-top","font-family","font-size","line-height"].forEach((function(e){t.style[e]=i[e]})),t.style["margin-bottom"]="-"+i["padding-top"]}}))}},_recordCurrentState:function(){var e=this.$refs.textarea;if(e){var t=e.value,i=e.selectionStart,a=e.selectionEnd;this._recordChange({value:t,selectionStart:i,selectionEnd:a})}},_getLines:function(e,t){return e.substring(0,t).split("\n")},_applyEdits:function(e){var t=this.$refs.textarea,i=this.history.stack[this.history.offset];i&&t&&(this.history.stack[this.history.offset]=u({},i,{selectionStart:t.selectionStart,selectionEnd:t.selectionEnd})),this._recordChange(e),this._updateInput(e)},_recordChange:function(e,t){void 0===t&&(t=!1);var i=this.history,a=i.stack,o=i.offset;if(a.length&&o>-1){this.history.stack=a.slice(0,o+1);var n=this.history.stack.length;if(n>100){var s=n-100;this.history.stack=a.slice(s,n),this.history.offset=Math.max(this.history.offset-s,0)}}var r=Date.now();if(t){var l=this.history.stack[this.history.offset];if(l&&r-l.timestamp<3e3){var d,c,h=/[^a-z0-9]([a-z0-9]+)$/i,p=null===(d=this._getLines(l.value,l.selectionStart).pop())||void 0===d?void 0:d.match(h),f=null===(c=this._getLines(e.value,e.selectionStart).pop())||void 0===c?void 0:c.match(h);if(p&&f&&f[1].startsWith(p[1]))return void(this.history.stack[this.history.offset]=u({},e,{timestamp:r}))}}this.history.stack.push(u({},e,{timestamp:r})),this.history.offset++},_updateInput:function(e){var t=this.$refs.textarea;t&&(t.value=e.value,t.selectionStart=e.selectionStart,t.selectionEnd=e.selectionEnd,this.$emit("update:modelValue",e.value))},handleChange:function(e){var t=e.target,i=t.value,a=t.selectionStart,o=t.selectionEnd;this._recordChange({value:i,selectionStart:a,selectionEnd:o},!0),this.$emit("update:modelValue",i)},_undoEdit:function(){var e=this.history,t=e.stack,i=e.offset,a=t[i-1];a&&(this._updateInput(a),this.history.offset=Math.max(i-1,0))},_redoEdit:function(){var e=this.history,t=e.stack,i=e.offset,a=t[i+1];a&&(this._updateInput(a),this.history.offset=Math.min(i+1,t.length-1))},handleKeyDown:function(e){var t=this.tabSize,i=this.insertSpaces,a=this.ignoreTabKey;if(this.$emit("keydown",e),!e.defaultPrevented){27===e.keyCode&&(e.target.blur(),this.$emit("blur",e));var o=e.target,n=o.value,s=o.selectionStart,r=o.selectionEnd,l=(i?" ":"\t").repeat(t);if(9===e.keyCode&&!a&&this.capture)if(e.preventDefault(),e.shiftKey){var d=this._getLines(n,s),c=d.length-1,h=this._getLines(n,r).length-1,u=n.split("\n").map((function(e,t){return t>=c&&t<=h&&e.startsWith(l)?e.substring(l.length):e})).join("\n");if(n!==u){var g=d[c];this._applyEdits({value:u,selectionStart:g.startsWith(l)?s-l.length:s,selectionEnd:r-(n.length-u.length)})}}else if(s!==r){var v=this._getLines(n,s),y=v.length-1,m=this._getLines(n,r).length-1,b=v[y];this._applyEdits({value:n.split("\n").map((function(e,t){return t>=y&&t<=m?l+e:e})).join("\n"),selectionStart:/\S/.test(b)?s+l.length:s,selectionEnd:r+l.length*(m-y+1)})}else{var k=s+l.length;this._applyEdits({value:n.substring(0,s)+l+n.substring(r),selectionStart:k,selectionEnd:k})}else if(8===e.keyCode){var _=s!==r;if(n.substring(0,s).endsWith(l)&&!_){e.preventDefault();var x=s-l.length;this._applyEdits({value:n.substring(0,s-l.length)+n.substring(r),selectionStart:x,selectionEnd:x})}}else if(13===e.keyCode){if(s===r){var S=this._getLines(n,s).pop(),w=null==S?void 0:S.match(/^\s+/);if(w&&w[0]){e.preventDefault();var C="\n"+w[0],N=s+C.length;this._applyEdits({value:n.substring(0,s)+C+n.substring(r),selectionStart:N,selectionEnd:N})}}}else if(57===e.keyCode||219===e.keyCode||222===e.keyCode||192===e.keyCode){var E;57===e.keyCode&&e.shiftKey?E=["(",")"]:219===e.keyCode?E=e.shiftKey?["{","}"]:["[","]"]:222===e.keyCode?E=e.shiftKey?['"','"']:["'","'"]:192!==e.keyCode||e.shiftKey||(E=["`","`"]),s!==r&&E&&(e.preventDefault(),this._applyEdits({value:n.substring(0,s)+E[0]+n.substring(s,r)+E[1]+n.substring(r),selectionStart:s,selectionEnd:r+2}))}else!(f?e.metaKey&&90===e.keyCode:e.ctrlKey&&90===e.keyCode)||e.shiftKey||e.altKey?(f?e.metaKey&&90===e.keyCode&&e.shiftKey:p?e.ctrlKey&&89===e.keyCode:e.ctrlKey&&90===e.keyCode&&e.shiftKey)&&!e.altKey?(e.preventDefault(),this._redoEdit()):77!==e.keyCode||!e.ctrlKey||f&&!e.shiftKey||(e.preventDefault(),this.capture=!this.capture):(e.preventDefault(),this._undoEdit())}}},render:function(){var e=this,t=(0,a.h)("div",{class:"prism-editor__line-width-calc",style:"height: 0px; visibility: hidden; pointer-events: none;"},"999"),i=(0,a.h)("div",{class:"prism-editor__line-numbers",style:{"min-height":this.lineNumbersHeight},"aria-hidden":"true"},[t,Array.from(Array(this.lineNumbersCount).keys()).map((function(e,t){return(0,a.h)("div",{class:"prism-editor__line-number token comment"},""+ ++t)}))]),o=(0,a.h)("textarea",{ref:"textarea",onInput:this.handleChange,onKeydown:this.handleKeyDown,onClick:function(t){e.$emit("click",t)},onKeyup:function(t){e.$emit("keyup",t)},onFocus:function(t){e.$emit("focus",t)},onBlur:function(t){e.$emit("blur",t)},class:{"prism-editor__textarea":!0,"prism-editor__textarea--empty":this.isEmpty},spellCheck:"false",autocapitalize:"off",autocomplete:"off",autocorrect:"off","data-gramm":"false",placeholder:this.placeholder,"data-testid":"textarea",readonly:this.readonly,value:this.codeData}),n=(0,a.h)("pre",{ref:"pre",class:"prism-editor__editor","data-testid":"preview",innerHTML:this.content}),s=(0,a.h)("div",{class:"prism-editor__container"},[o,n]);return(0,a.h)("div",{class:"prism-editor-wrapper"},[this.lineNumbers&&i,s])}}),v=(i(88252),i(27328)),y=i(69146),m=i(42453),b=i(31064),k=i(10192);const _=(0,a.defineComponent)({components:{MkContainer:y.Z,MkButton:m.Z,PrismEditor:g},data(){return{INFO:{title:this.$ts.scratchpad,icon:c.Jw3},code:"",logs:[],faTerminal:c.Jw3,faPlay:c.zc}},watch:{code(){localStorage.setItem("scratchpad",this.code)}},created(){const e=localStorage.getItem("scratchpad");e&&(this.code=e)},methods:{async run(){var e;this.logs=[];const t=new v.AiScript((0,b.a)({storageKey:"scratchpad",token:null===(e=this.$i)||void 0===e?void 0:e.token}),{in:e=>new Promise((t=>{k.WZ({title:e,input:{}}).then((({canceled:e,result:i})=>{t(i)}))})),out:e=>{this.logs.push({id:Math.random(),text:"str"===e.type?e.value:v.utils.valToString(e),print:!0})},log:(e,t)=>{switch(e){case"end":this.logs.push({id:Math.random(),text:v.utils.valToString(t.val,!0),print:!1})}}});let i;try{i=(0,v.parse)(this.code)}catch(e){return void k.WZ({type:"error",text:"Syntax error :("})}try{await t.exec(i)}catch(e){k.WZ({type:"error",text:e})}},highlighter:e=>(0,h.highlight)(e,h.languages.js,"javascript")}});i(17092);_.render=d,_.__scopeId="data-v-2cffdb2f";const x=_},64935:(e,t,i)=>{var a=i(62960);"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);(0,i(45346).Z)("ab0d80cc",a,!0,{})},17092:(e,t,i)=>{var a=i(32734);"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);(0,i(45346).Z)("b7dfe226",a,!0,{})},63906:()=>{}}]);