(self.webpackChunkmisskey=self.webpackChunkmisskey||[]).push([[1114],{9812:(e,t)=>{"use strict";const a={def:0,assign:1,call:2,return:3,if:4,for:5,forOf:6,var:7,null:8,bool:9,num:10,str:11,arr:12,fn:13,obj:14,prop:15,propCall:16,index:17,block:18,tmpl:19,ns:20,match:21,meta:22,propAssign:23,indexAssign:24,inc:25,dec:26};function n(e){if(null==e)return null;switch(e.type){case"def":return[a[e.type],e.name,e.mut,n(e.expr)];case"assign":return[a[e.type],e.name,n(e.expr)];case"call":return[a[e.type],e.name,r(e.args)];case"return":return[a[e.type],n(e.expr)];case"if":return[a[e.type],n(e.cond),n(e.then),e.elseif.map((e=>[n(e.cond),n(e.then)])),n(e.else)];case"for":return[a[e.type],e.var,n(e.from),n(e.to),n(e.times),n(e.for)];case"forOf":return[a[e.type],e.var,n(e.items),n(e.for)];case"var":return[a[e.type],e.name];case"null":return[a[e.type]];case"bool":case"num":case"str":return[a[e.type],e.value];case"arr":return[a[e.type],r(e.value)];case"fn":return[a[e.type],e.args,r(e.children)];case"obj":return[a[e.type],Array.from(e.value.entries()).map((e=>[e[0],n(e[1])]))];case"prop":return[a[e.type],e.obj,e.path];case"propCall":return[a[e.type],e.obj,e.path,r(e.args)];case"index":return[a[e.type],e.arr,n(e.i)];case"block":return[a[e.type],r(e.statements)];case"tmpl":return[a[e.type],e.tmpl.map((e=>"string"==typeof e?e:n(e)))];case"ns":return[a[e.type],e.name,r(e.members)];case"match":return[a[e.type],n(e.about),e.qs.map((e=>[n(e.q),n(e.a)])),n(e.default)];case"meta":return[a[e.type],e.name,n(e.value)];case"propAssign":return[a[e.type],e.obj,e.path,n(e.expr)];case"indexAssign":return[a[e.type],e.arr,n(e.i),n(e.expr)];case"inc":case"dec":return[a[e.type],e.name,n(e.expr)]}}function r(e){return e.map((e=>n(e)))}function s(e){if(null==e)return;const t=Object.keys(a).find((t=>a[t]===e[0]));switch(e[0]){case a.def:return{type:t,name:e[1],mut:e[2],expr:s(e[3])};case a.assign:return{type:t,name:e[1],expr:s(e[2])};case a.call:return{type:t,name:e[1],args:l(e[2])};case a.return:return{type:t,expr:s(e[1])};case a.if:return{type:t,cond:s(e[1]),then:s(e[2]),elseif:e[3].map((e=>({cond:s(e[0]),then:s(e[1])}))),else:s(e[4])};case a.for:return{type:t,var:e[1]||void 0,from:s(e[2]),to:s(e[3]),times:s(e[4]),for:s(e[5])};case a.forOf:return{type:t,var:e[1],items:s(e[2]),for:s(e[3])};case a.var:return{type:t,name:e[1]};case a.null:return{type:t};case a.bool:case a.num:case a.str:return{type:t,value:e[1]};case a.arr:return{type:t,value:l(e[1])};case a.fn:return{type:t,args:e[1],children:l(e[2])};case a.obj:return{type:t,value:new Map(e[1].map((e=>[e[0],s(e[1])])))};case a.prop:return{type:t,obj:e[1],path:e[2]};case a.propCall:return{type:t,obj:e[1],path:e[2],args:l(e[3])};case a.index:return{type:t,arr:e[1],i:s(e[2])};case a.block:return{type:t,statements:l(e[1])};case a.tmpl:return{type:t,tmpl:e[1].map((e=>"string"==typeof e?e:s(e)))};case a.ns:return{type:t,name:e[1],members:l(e[2])};case a.match:return{type:t,about:s(e[1]),qs:e[2].map((e=>({q:s(e[0]),a:s(e[1])}))),default:s(e[3])};case a.meta:return{type:t,name:e[1],value:s(e[2])};case a.propAssign:return{type:t,obj:e[1],path:e[2],expr:s(e[3])};case a.indexAssign:return{type:t,arr:e[1],i:s(e[2]),expr:s(e[3])};case a.inc:case a.dec:return{type:t,name:e[1],expr:s(e[2])}}throw new Error("deserialization failed")}function l(e){return e.map((e=>s(e)))}t.qC=r,t.vB=l},60335:(e,t,a)=>{"use strict";a.r(t),a.d(t,{install:()=>c});var n=a(27328),r=a(9812),s=a(82890),l=a(31064),u=a(10192),i=a(73120);const p=new Map;function c(e){console.info("Plugin installed:",e.name,"v"+e.version);const t=new n.AiScript(function(e){const t=new Map;for(const[a,n]of Object.entries(e.plugin.config||{}))t.set(a,(0,s.jsToVal)(e.plugin.configData.hasOwnProperty(a)?e.plugin.configData[a]:n.default));return Object.assign(Object.assign({},(0,l.a)(Object.assign(Object.assign({},e),{token:e.plugin.token}))),{"Mk:register_post_form_action":n.values.FN_NATIVE((([t,a])=>{o({pluginId:e.plugin.id,title:t.value,handler:a})})),"Mk:register_user_action":n.values.FN_NATIVE((([t,a])=>{g({pluginId:e.plugin.id,title:t.value,handler:a})})),"Mk:register_note_action":n.values.FN_NATIVE((([t,a])=>{d({pluginId:e.plugin.id,title:t.value,handler:a})})),"Plugin:register_post_form_action":n.values.FN_NATIVE((([t,a])=>{o({pluginId:e.plugin.id,title:t.value,handler:a})})),"Plugin:register_user_action":n.values.FN_NATIVE((([t,a])=>{g({pluginId:e.plugin.id,title:t.value,handler:a})})),"Plugin:register_note_action":n.values.FN_NATIVE((([t,a])=>{d({pluginId:e.plugin.id,title:t.value,handler:a})})),"Plugin:register_note_view_interruptor":n.values.FN_NATIVE((([t])=>{!function({pluginId:e,handler:t}){i.n$.push({handler:async a=>n.utils.valToJs(await p.get(e).execFn(t,[n.utils.jsToVal(a)]))})}({pluginId:e.plugin.id,handler:t})})),"Plugin:register_note_post_interruptor":n.values.FN_NATIVE((([t])=>{!function({pluginId:e,handler:t}){i.Mm.push({handler:async a=>n.utils.valToJs(await p.get(e).execFn(t,[n.utils.jsToVal(a)]))})}({pluginId:e.plugin.id,handler:t})})),"Plugin:open_url":n.values.FN_NATIVE((([e])=>{window.open(e.value,"_blank")})),"Plugin:config":n.values.OBJ(t)})}({plugin:e,storageKey:"plugins:"+e.id}),{in:e=>new Promise((t=>{(0,u.WZ)({title:e,input:{}}).then((({canceled:e,result:a})=>{t(a)}))})),out:e=>{console.log(e)},log:(e,t)=>{}});!function({plugin:e,aiscript:t}){p.set(e.id,t)}({plugin:e,aiscript:t}),t.exec((0,r.vB)(e.ast))}function o({pluginId:e,title:t,handler:a}){i.sq.push({title:t,handler:(t,r)=>{p.get(e).execFn(a,[n.utils.jsToVal(t),n.values.FN_NATIVE((([e,t])=>{r(e.value,t.value)}))])}})}function g({pluginId:e,title:t,handler:a}){i.hI.push({title:t,handler:t=>{p.get(e).execFn(a,[n.utils.jsToVal(t)])}})}function d({pluginId:e,title:t,handler:a}){i.aJ.push({title:t,handler:t=>{p.get(e).execFn(a,[n.utils.jsToVal(t)])}})}},31064:(e,t,a)=>{"use strict";a.d(t,{a:()=>l});var n=a(27328),r=a(10192),s=a(37200);function l(e){let t=0;return{USER_ID:s.$i?n.values.STR(s.$i.id):n.values.NULL,USER_NAME:s.$i?n.values.STR(s.$i.name):n.values.NULL,USER_USERNAME:s.$i?n.values.STR(s.$i.username):n.values.NULL,"Mk:dialog":n.values.FN_NATIVE((async([e,t,a])=>{await r.WZ({type:a?a.value:"info",title:e.value,text:t.value})})),"Mk:confirm":n.values.FN_NATIVE((async([e,t,a])=>(await r.WZ({type:a?a.value:"question",showCancelButton:!0,title:e.value,text:t.value})).canceled?n.values.FALSE:n.values.TRUE)),"Mk:api":n.values.FN_NATIVE((async([a,s,l])=>{if(l&&n.utils.assertString(l),t++,t>16)return n.values.NULL;const u=await r.hi(a.value,n.utils.valToJs(s),l?l.value:e.token||null);return n.utils.jsToVal(u)})),"Mk:save":n.values.FN_NATIVE((([t,a])=>(n.utils.assertString(t),localStorage.setItem("aiscript:"+e.storageKey+":"+t.value,JSON.stringify(n.utils.valToJs(a))),n.values.NULL))),"Mk:load":n.values.FN_NATIVE((([t])=>(n.utils.assertString(t),n.utils.jsToVal(JSON.parse(localStorage.getItem("aiscript:"+e.storageKey+":"+t.value))))))}}},63906:()=>{}}]);