(self.webpackChunkmisskey=self.webpackChunkmisskey||[]).push([[5758],{33404:(e,t,s)=>{var i=s(23645)((function(e){return e[1]}));i.push([e.id,".swhvrteh[data-v-410199ea]{position:fixed;z-index:65535;max-width:100%;margin-top:calc(1em + 8px);overflow:hidden;transition:top .1s ease,left .1s ease}.swhvrteh>ol[data-v-410199ea]{display:block;margin:0;padding:4px 0;max-height:190px;max-width:500px;overflow:auto;list-style:none}.swhvrteh>ol>li[data-v-410199ea]{display:flex;align-items:center;padding:4px 12px;white-space:nowrap;overflow:hidden;font-size:.9em;cursor:default}.swhvrteh>ol>li[data-v-410199ea],.swhvrteh>ol>li *[data-v-410199ea]{user-select:none}.swhvrteh>ol>li *[data-v-410199ea]{overflow:hidden;text-overflow:ellipsis}.swhvrteh>ol>li[data-v-410199ea]:hover{background:var(--X3)}.swhvrteh>ol>li[data-selected=true][data-v-410199ea]{background:var(--accent)}.swhvrteh>ol>li[data-selected=true][data-v-410199ea],.swhvrteh>ol>li[data-selected=true] *[data-v-410199ea]{color:#fff!important}.swhvrteh>ol>li[data-v-410199ea]:active{background:var(--accentDarken)}.swhvrteh>ol>li[data-v-410199ea]:active,.swhvrteh>ol>li:active *[data-v-410199ea]{color:#fff!important}.swhvrteh>.users>li .avatar[data-v-410199ea]{min-width:28px;min-height:28px;max-width:28px;max-height:28px;margin:0 8px 0 0;border-radius:100%}.swhvrteh>.users>li .name[data-v-410199ea]{margin:0 8px 0 0}.swhvrteh>.emojis>li .emoji[data-v-410199ea]{display:inline-block;margin:0 4px 0 0;width:24px}.swhvrteh>.emojis>li .emoji>img[data-v-410199ea]{width:24px;vertical-align:bottom}.swhvrteh>.emojis>li .alias[data-v-410199ea]{margin:0 0 0 8px}",""]),e.exports=i},32174:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});const i=(e,t,s=!0)=>{if(s&&e===t)return!0;let i=t.parentNode;for(;i;){if(i==e)return!0;i=i.parentNode}return!1}},5758:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>S});var i=s(55393);const o=(0,i.withScopeId)("data-v-410199ea");(0,i.pushScopeId)("data-v-410199ea");const a={key:0,class:"users",ref:"suggests"},n={class:"name"},r={class:"username"},l={key:1,class:"hashtags",ref:"suggests"},h={class:"name"},c={key:2,class:"emojis",ref:"suggests"},m={key:0,class:"emoji"},d={key:1,class:"emoji"},p={key:2,class:"emoji"},u={key:3,class:"alias"};(0,i.popScopeId)();const g=o(((e,t,s,o,g,f)=>{const v=(0,i.resolveComponent)("MkUserName");return(0,i.openBlock)(),(0,i.createBlock)("div",{class:"swhvrteh _popup _shadow",onContextmenu:t[6]||(t[6]=(0,i.withModifiers)((()=>{}),["prevent"]))},["user"===e.type?((0,i.openBlock)(),(0,i.createBlock)("ol",a,[((0,i.openBlock)(!0),(0,i.createBlock)(i.Fragment,null,(0,i.renderList)(e.users,(s=>((0,i.openBlock)(),(0,i.createBlock)("li",{onClick:t=>e.complete(e.type,s),onKeydown:t[1]||(t[1]=(...t)=>e.onKeydown&&e.onKeydown(...t)),tabindex:"-1",class:"user"},[(0,i.createVNode)("img",{class:"avatar",src:s.avatarUrl},null,8,["src"]),(0,i.createVNode)("span",n,[(0,i.createVNode)(v,{user:s,key:s.id},null,8,["user"])]),(0,i.createVNode)("span",r,"@"+(0,i.toDisplayString)(e.acct(s)),1)],40,["onClick"])))),256)),(0,i.createVNode)("li",{onClick:t[2]||(t[2]=t=>e.chooseUser()),onKeydown:t[3]||(t[3]=(...t)=>e.onKeydown&&e.onKeydown(...t)),tabindex:"-1",class:"choose"},(0,i.toDisplayString)(e.$ts.selectUser),33)],512)):(0,i.createCommentVNode)("",!0),e.hashtags.length>0?((0,i.openBlock)(),(0,i.createBlock)("ol",l,[((0,i.openBlock)(!0),(0,i.createBlock)(i.Fragment,null,(0,i.renderList)(e.hashtags,(s=>((0,i.openBlock)(),(0,i.createBlock)("li",{onClick:t=>e.complete(e.type,s),onKeydown:t[4]||(t[4]=(...t)=>e.onKeydown&&e.onKeydown(...t)),tabindex:"-1"},[(0,i.createVNode)("span",h,(0,i.toDisplayString)(s),1)],40,["onClick"])))),256))],512)):(0,i.createCommentVNode)("",!0),e.emojis.length>0?((0,i.openBlock)(),(0,i.createBlock)("ol",c,[((0,i.openBlock)(!0),(0,i.createBlock)(i.Fragment,null,(0,i.renderList)(e.emojis,(s=>((0,i.openBlock)(),(0,i.createBlock)("li",{onClick:t=>e.complete(e.type,s.emoji),onKeydown:t[5]||(t[5]=(...t)=>e.onKeydown&&e.onKeydown(...t)),tabindex:"-1"},[s.isCustomEmoji?((0,i.openBlock)(),(0,i.createBlock)("span",m,[(0,i.createVNode)("img",{src:e.$store.state.disableShowingAnimatedImages?e.getStaticImageUrl(s.url):s.url,alt:s.emoji},null,8,["src","alt"])])):e.$store.state.useOsNativeEmojis?((0,i.openBlock)(),(0,i.createBlock)("span",p,(0,i.toDisplayString)(s.emoji),1)):((0,i.openBlock)(),(0,i.createBlock)("span",d,[(0,i.createVNode)("img",{src:s.url,alt:s.emoji},null,8,["src","alt"])])),(0,i.createVNode)("span",{class:"name",innerHTML:s.name.replace(e.q,`<b>${e.q}</b>`)},null,8,["innerHTML"]),s.aliasOf?((0,i.openBlock)(),(0,i.createBlock)("span",u,"("+(0,i.toDisplayString)(s.aliasOf)+")",1)):(0,i.createCommentVNode)("",!0)],40,["onClick"])))),256))],512)):(0,i.createCommentVNode)("",!0)],32)}));var f=s(59411),v=s(32174),y=s(62100),w=s(87774),k=s(55006),x=s(10192);const j=f.W.filter((e=>"flags"!==e.category)),b=e=>{let t=Array.from(e).map((e=>e.codePointAt(0).toString(16)));return t.includes("200d")||(t=t.filter((e=>"fe0f"!=e))),t=t.filter((e=>e&&e.length)),t.join("-")},$=j.map((e=>({emoji:e.char,name:e.name,aliasOf:null,url:`${y.P}/${b(e.char)}.svg`})));for(const e of j)if(e.keywords)for(const t of e.keywords)$.push({emoji:e.char,name:t,aliasOf:e.name,url:`${y.P}/${b(e.char)}.svg`});$.sort(((e,t)=>e.name.length-t.name.length));const B=(0,i.defineComponent)({props:{type:{type:String,required:!0},q:{type:String,required:!1},textarea:{type:HTMLTextAreaElement,required:!0},close:{type:Function,required:!0},x:{type:Number,required:!0},y:{type:Number,required:!0},showing:{type:Boolean,required:!0}},emits:["done","closed"],data:()=>({getStaticImageUrl:w.e,fetching:!0,users:[],hashtags:[],emojis:[],items:[],select:-1,emojiDb:[]}),watch:{showing(){this.showing||this.$emit("closed")}},updated(){var e;this.setPosition(),this.items=(null===(e=this.$refs.suggests)||void 0===e?void 0:e.children)||[]},mounted(){this.setPosition();const e=this.$instance.emojis,t=[];for(const s of e)if(t.push({name:s.name,emoji:`:${s.name}:`,url:s.url,isCustomEmoji:!0}),s.aliases)for(const e of s.aliases)t.push({name:e,aliasOf:s.name,emoji:`:${s.name}:`,url:s.url,isCustomEmoji:!0});t.sort(((e,t)=>e.name.length-t.name.length)),this.emojiDb=(0,i.markRaw)(t.concat($)),this.textarea.addEventListener("keydown",this.onKeydown);for(const e of Array.from(document.querySelectorAll("body *")))e.addEventListener("mousedown",this.onMousedown);this.$nextTick((()=>{this.exec(),this.$watch("q",(()=>{this.$nextTick((()=>{this.exec()}))}))}))},beforeUnmount(){this.textarea.removeEventListener("keydown",this.onKeydown);for(const e of Array.from(document.querySelectorAll("body *")))e.removeEventListener("mousedown",this.onMousedown)},methods:{complete(e,t){this.$emit("done",{type:e,value:t}),this.$emit("closed")},setPosition(){this.x+this.$el.offsetWidth>window.innerWidth?this.$el.style.left=window.innerWidth-this.$el.offsetWidth+"px":this.$el.style.left=this.x+"px",this.y+this.$el.offsetHeight>window.innerHeight?(this.$el.style.top=this.y-this.$el.offsetHeight+"px",this.$el.style.marginTop="0"):(this.$el.style.top=this.y+"px",this.$el.style.marginTop="calc(1em + 8px)")},exec(){if(this.select=-1,this.$refs.suggests)for(const e of Array.from(this.items))e.removeAttribute("data-selected");if("user"==this.type){if(null==this.q)return this.users=[],void(this.fetching=!1);const e="autocomplete:user:"+this.q,t=sessionStorage.getItem(e);if(t){const e=JSON.parse(t);this.users=e,this.fetching=!1}else x.hi("users/search-by-username-and-host",{username:this.q,limit:10,detail:!1}).then((t=>{this.users=t,this.fetching=!1,sessionStorage.setItem(e,JSON.stringify(t))}))}else if("hashtag"==this.type)if(null==this.q||""==this.q)this.hashtags=JSON.parse(localStorage.getItem("hashtags")||"[]"),this.fetching=!1;else{const e="autocomplete:hashtag:"+this.q,t=sessionStorage.getItem(e);if(t){const e=JSON.parse(t);this.hashtags=e,this.fetching=!1}else x.hi("hashtags/search",{query:this.q,limit:30}).then((t=>{this.hashtags=t,this.fetching=!1,sessionStorage.setItem(e,JSON.stringify(t))}))}else if("emoji"==this.type){if(null==this.q||""==this.q)return void(this.emojis=this.emojiDb.filter((e=>e.isCustomEmoji&&!e.aliasOf)).sort(((e,t)=>{var s=e.name.toUpperCase(),i=t.name.toUpperCase();return s<i?-1:s>i?1:0})));const e=[],t=30;this.emojiDb.some((s=>(!s.name.startsWith(this.q)||s.aliasOf||e.some((e=>e.emoji==s.emoji))||e.push(s),e.length==t))),e.length<t&&this.emojiDb.some((s=>(s.name.startsWith(this.q)&&!e.some((e=>e.emoji==s.emoji))&&e.push(s),e.length==t))),e.length<t&&this.emojiDb.some((s=>(s.name.includes(this.q)&&!e.some((e=>e.emoji==s.emoji))&&e.push(s),e.length==t))),this.emojis=e}},onMousedown(e){(0,v.Z)(this.$el,e.target)||this.$el==e.target||this.close()},onKeydown(e){const t=()=>{e.preventDefault(),e.stopPropagation()};switch(e.which){case 10:case 13:-1!==this.select?(t(),this.items[this.select].click()):this.close();break;case 27:t(),this.close();break;case 38:-1!==this.select?(t(),this.selectPrev()):this.close();break;case 9:case 40:t(),this.selectNext();break;default:e.stopPropagation(),this.textarea.focus()}},selectNext(){++this.select>=this.items.length&&(this.select=0),0===this.items.length&&(this.select=-1),this.applySelect()},selectPrev(){--this.select<0&&(this.select=this.items.length-1),this.applySelect()},applySelect(){for(const e of Array.from(this.items))e.removeAttribute("data-selected");-1!==this.select&&(this.items[this.select].setAttribute("data-selected","true"),this.items[this.select].focus())},chooseUser(){this.close(),x.dy().then((e=>{this.complete("user",e),this.textarea.focus()}))},acct:k.R}});s(10592);B.render=g,B.__scopeId="data-v-410199ea";const S=B},10592:(e,t,s)=>{var i=s(33404);"string"==typeof i&&(i=[[e.id,i,""]]),i.locals&&(e.exports=i.locals);(0,s(45346).Z)("7b002380",i,!0,{})}}]);