(()=>{"use strict";function e(e){return new Promise(((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)}))}let t;function n(){return t||(t=function(t,n){const o=indexedDB.open(t);o.onupgradeneeded=()=>o.result.createObjectStore(n);const r=e(o);return(e,t)=>r.then((o=>t(o.transaction(n,e).objectStore(n))))}("keyval-store","keyval")),t}const o=(e,t)=>{if(e.deletedAt)return`(${t.deletedNote})`;if(e.isHidden)return`(${t.invisibleNote})`;let n="";return null!=e.cw?n+=e.cw:n+=e.text?e.text:"",0!=(e.files||[]).length&&(n+=` (${t.withNFiles.replace("{n}",e.files.length)})`),e.poll&&(n+=` (${t.poll})`),e.replyId&&(e.reply?n+="\n\nRE: "+o(e.reply,t):n+="\n\nRE: ..."),e.renoteId&&(e.renote?n+="\n\nRN: "+o(e.renote,t):n+="\n\nRN: ..."),n.trim()};function r(e){return e.name||e.username}async function a(e,t,n){if(n)switch(e){case"driveFileCreated":return[n.t("_notification.fileUploaded"),{body:t.name,icon:t.url}];case"notification":switch(t.type){case"mention":return[n.t("_notification.youGotMention",{name:r(t.user)}),{body:o(t.note,n.locale),icon:t.user.avatarUrl}];case"reply":return[n.t("_notification.youGotReply",{name:r(t.user)}),{body:o(t.note,n.locale),icon:t.user.avatarUrl}];case"renote":return[n.t("_notification.youRenoted",{name:r(t.user)}),{body:o(t.note,n.locale),icon:t.user.avatarUrl}];case"quote":return[n.t("_notification.youGotQuote",{name:r(t.user)}),{body:o(t.note,n.locale),icon:t.user.avatarUrl}];case"reaction":return[`${t.reaction} ${r(t.user)}`,{body:o(t.note,n.locale),icon:t.user.avatarUrl}];case"pollVote":return[n.t("_notification.youGotPoll",{name:r(t.user)}),{body:o(t.note,n.locale),icon:t.user.avatarUrl}];case"follow":return[n.t("_notification.youWereFollowed"),{body:r(t.user),icon:t.user.avatarUrl}];case"receiveFollowRequest":return[n.t("_notification.youReceivedFollowRequest"),{body:r(t.user),icon:t.user.avatarUrl}];case"followRequestAccepted":return[n.t("_notification.yourFollowRequestAccepted"),{body:r(t.user),icon:t.user.avatarUrl}];case"groupInvited":return[n.t("_notification.youWereInvitedToGroup"),{body:t.group.name}];default:return null}case"unreadMessagingMessage":return null===t.groupId?[n.t("_notification.youGotMessagingMessageFromUser",{name:r(t.user)}),{icon:t.user.avatarUrl,tag:"messaging:user:"+t.user.id}]:[n.t("_notification.youGotMessagingMessageFromGroup",{name:t.group.name}),{icon:t.user.avatarUrl,tag:"messaging:group:"+t.group.id}];default:return null}else console.log("no i18n")}class i{constructor(e){this.locale=e,this.t=this.t.bind(this)}t(e,t){try{let n=e.split(".").reduce(((e,t)=>e[t]),this.locale);if(t)for(const[e,o]of Object.entries(t))n=n.replace(`{${e}}`,o);return n}catch(t){return console.warn(`missing localization '${e}'`),e}}}const s="12.71.0-rei0784",l="mk-cache-"+s;let c,u,d=[];async function f(){const e=`/assets/locales/${c}.${s}.json`;let t=await caches.match(e);if(!t){t=await fetch(e);const n=null==t?void 0:t.clone();if(!(null==n?void 0:n.clone().ok))return;caches.open(l).then((t=>t.put(e,n)))}u=new i(await t.json());for(const{type:e,body:t}of d){const n=await a(e,t,u);n&&self.registration.showNotification(...n)}d=[]}(function(t,o=n()){return o("readonly",(n=>e(n.get(t))))})("lang").then((async e=>{if(e)return c=e,f()})),self.addEventListener("install",(e=>{self.skipWaiting()})),self.addEventListener("activate",(e=>{e.waitUntil(caches.keys().then((e=>Promise.all(e.filter((e=>e!==l)).map((e=>caches.delete(e)))))).then((()=>self.clients.claim())))})),self.addEventListener("fetch",(e=>{})),self.addEventListener("push",(e=>{e.waitUntil(self.clients.matchAll({includeUncontrolled:!0}).then((async t=>{var n;if(0!=t.length)return;const{type:o,body:r}=null===(n=e.data)||void 0===n?void 0:n.json();if(!u)return d.push({type:o,body:r});const i=await a(o,r,u);return i?self.registration.showNotification(...i):void 0})))})),self.addEventListener("message",(t=>{switch(t.data){case"clear":return}if("object"==typeof t.data){"object"===Object.prototype.toString.call(t.data).slice(8,-1).toLowerCase()&&"initialize"===t.data.msg&&(c=t.data.lang,function(t,o,r=n()){r("readwrite",(n=>(n.put(o,t),e(n.transaction))))}("lang",c),f())}}))})();