(self.webpackChunkmisskey=self.webpackChunkmisskey||[]).push([[1855,6735],{34606:(e,t)=>{var o;o=function(e){e.version="1.2.0";var t=function(){for(var e=0,t=new Array(256),o=0;256!=o;++o)e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=o)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1,t[o]=e;return"undefined"!=typeof Int32Array?new Int32Array(t):t}();e.table=t,e.bstr=function(e,o){for(var a=-1^o,s=e.length-1,n=0;n<s;)a=(a=a>>>8^t[255&(a^e.charCodeAt(n++))])>>>8^t[255&(a^e.charCodeAt(n++))];return n===s&&(a=a>>>8^t[255&(a^e.charCodeAt(n))]),-1^a},e.buf=function(e,o){if(e.length>1e4)return function(e,o){for(var a=-1^o,s=e.length-7,n=0;n<s;)a=(a=(a=(a=(a=(a=(a=(a=a>>>8^t[255&(a^e[n++])])>>>8^t[255&(a^e[n++])])>>>8^t[255&(a^e[n++])])>>>8^t[255&(a^e[n++])])>>>8^t[255&(a^e[n++])])>>>8^t[255&(a^e[n++])])>>>8^t[255&(a^e[n++])])>>>8^t[255&(a^e[n++])];for(;n<s+7;)a=a>>>8^t[255&(a^e[n++])];return-1^a}(e,o);for(var a=-1^o,s=e.length-3,n=0;n<s;)a=(a=(a=(a=a>>>8^t[255&(a^e[n++])])>>>8^t[255&(a^e[n++])])>>>8^t[255&(a^e[n++])])>>>8^t[255&(a^e[n++])];for(;n<s+3;)a=a>>>8^t[255&(a^e[n++])];return-1^a},e.str=function(e,o){for(var a,s,n=-1^o,r=0,i=e.length;r<i;)(a=e.charCodeAt(r++))<128?n=n>>>8^t[255&(n^a)]:a<2048?n=(n=n>>>8^t[255&(n^(192|a>>6&31))])>>>8^t[255&(n^(128|63&a))]:a>=55296&&a<57344?(a=64+(1023&a),s=1023&e.charCodeAt(r++),n=(n=(n=(n=n>>>8^t[255&(n^(240|a>>8&7))])>>>8^t[255&(n^(128|a>>2&63))])>>>8^t[255&(n^(128|s>>6&15|(3&a)<<4))])>>>8^t[255&(n^(128|63&s))]):n=(n=(n=n>>>8^t[255&(n^(224|a>>12&15))])>>>8^t[255&(n^(128|a>>6&63))])>>>8^t[255&(n^(128|63&a))];return-1^n}},"undefined"==typeof DO_NOT_EXPORT_CRC?o(t):o({})},3575:(e,t,o)=>{var a=o(23645)((function(e){return e[1]}));a.push([e.id,".xqnhankfuuilcwvhgsopeqncafzsquya[data-v-6dd18f75]{text-align:center}.xqnhankfuuilcwvhgsopeqncafzsquya>.go-index[data-v-6dd18f75]{position:absolute;top:0;left:0;z-index:1;width:42px;height:42px}.xqnhankfuuilcwvhgsopeqncafzsquya>header[data-v-6dd18f75]{padding:8px;border-bottom:1px dashed var(--divider)}.xqnhankfuuilcwvhgsopeqncafzsquya>.board[data-v-6dd18f75]{width:calc(100% - 16px);max-width:500px;margin:0 auto}.xqnhankfuuilcwvhgsopeqncafzsquya>.board>.labels-x[data-v-6dd18f75]{height:16px;padding:0 16px;display:flex}.xqnhankfuuilcwvhgsopeqncafzsquya>.board>.labels-x>*[data-v-6dd18f75]{flex:1;display:flex;align-items:center;justify-content:center;font-size:.8em}.xqnhankfuuilcwvhgsopeqncafzsquya>.board>.labels-x[data-v-6dd18f75]>:first-child{margin-left:-2px}.xqnhankfuuilcwvhgsopeqncafzsquya>.board>.labels-x[data-v-6dd18f75]>:last-child{margin-right:-2px}.xqnhankfuuilcwvhgsopeqncafzsquya>.board>.flex[data-v-6dd18f75]{display:flex}.xqnhankfuuilcwvhgsopeqncafzsquya>.board>.flex>.labels-y[data-v-6dd18f75]{width:16px;display:flex;flex-direction:column}.xqnhankfuuilcwvhgsopeqncafzsquya>.board>.flex>.labels-y>*[data-v-6dd18f75]{flex:1;display:flex;align-items:center;justify-content:center;font-size:12px}.xqnhankfuuilcwvhgsopeqncafzsquya>.board>.flex>.labels-y[data-v-6dd18f75]>:first-child{margin-top:-2px}.xqnhankfuuilcwvhgsopeqncafzsquya>.board>.flex>.labels-y[data-v-6dd18f75]>:last-child{margin-bottom:-2px}.xqnhankfuuilcwvhgsopeqncafzsquya>.board>.flex>.cells[data-v-6dd18f75]{flex:1;display:grid;grid-gap:4px}.xqnhankfuuilcwvhgsopeqncafzsquya>.board>.flex>.cells>div[data-v-6dd18f75]{background:transparent;border-radius:6px;overflow:hidden}.xqnhankfuuilcwvhgsopeqncafzsquya>.board>.flex>.cells>div *[data-v-6dd18f75]{pointer-events:none;user-select:none}.xqnhankfuuilcwvhgsopeqncafzsquya>.board>.flex>.cells>div.empty[data-v-6dd18f75]{border:2px solid var(--divider)}.xqnhankfuuilcwvhgsopeqncafzsquya>.board>.flex>.cells>div.empty.can[data-v-6dd18f75]{border-color:var(--accent)}.xqnhankfuuilcwvhgsopeqncafzsquya>.board>.flex>.cells>div.empty.myTurn[data-v-6dd18f75]{border-color:var(--divider)}.xqnhankfuuilcwvhgsopeqncafzsquya>.board>.flex>.cells>div.empty.myTurn.can[data-v-6dd18f75]{border-color:var(--accent);cursor:pointer}.xqnhankfuuilcwvhgsopeqncafzsquya>.board>.flex>.cells>div.empty.myTurn.can[data-v-6dd18f75]:hover{background:var(--accent)}.xqnhankfuuilcwvhgsopeqncafzsquya>.board>.flex>.cells>div.prev[data-v-6dd18f75]{box-shadow:0 0 0 4px var(--accent)}.xqnhankfuuilcwvhgsopeqncafzsquya>.board>.flex>.cells>div.isEnded[data-v-6dd18f75]{border-color:var(--divider)}.xqnhankfuuilcwvhgsopeqncafzsquya>.board>.flex>.cells>div.none[data-v-6dd18f75]{border-color:transparent!important}.xqnhankfuuilcwvhgsopeqncafzsquya>.board>.flex>.cells>div>img[data-v-6dd18f75],.xqnhankfuuilcwvhgsopeqncafzsquya>.board>.flex>.cells>div>svg[data-v-6dd18f75]{display:block;width:100%;height:100%}.xqnhankfuuilcwvhgsopeqncafzsquya>.status[data-v-6dd18f75]{margin:0;padding:16px 0}.xqnhankfuuilcwvhgsopeqncafzsquya>.actions[data-v-6dd18f75]{padding-bottom:16px}.xqnhankfuuilcwvhgsopeqncafzsquya>.player[data-v-6dd18f75]{padding:0 16px 32px;margin:0 auto;max-width:500px}.xqnhankfuuilcwvhgsopeqncafzsquya>.player>span[data-v-6dd18f75]{display:inline-block;margin:0 8px;min-width:70px}.xqnhankfuuilcwvhgsopeqncafzsquya>.player>.buttons[data-v-6dd18f75]{display:flex}.xqnhankfuuilcwvhgsopeqncafzsquya>.player>.buttons>*[data-v-6dd18f75]{flex:1}.xqnhankfuuilcwvhgsopeqncafzsquya>.watchers[data-v-6dd18f75]{padding:0 0 16px}.xqnhankfuuilcwvhgsopeqncafzsquya>.watchers[data-v-6dd18f75]:empty{display:none}.xqnhankfuuilcwvhgsopeqncafzsquya>.watchers>.avatar[data-v-6dd18f75]{width:32px;height:32px}",""]),e.exports=a},96735:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>j});var a=o(55393);const s=(0,a.withScopeId)("data-v-6dd18f75");(0,a.pushScopeId)("data-v-6dd18f75");const n={class:"xqnhankfuuilcwvhgsopeqncafzsquya"},r={style:{overflow:"hidden","line-height":"28px"}},i={key:0,class:"turn"},l={key:1,class:"turn"},c={key:2,class:"turn1"},d={key:3,class:"turn2",style:{animation:"tada 1s linear infinite both"}},h={key:4,class:"result"},u={key:0},p={class:"board"},g={key:0,class:"labels-x"},m={class:"flex"},f={key:0,class:"labels-y"},v={key:1,class:"labels-y"},k={key:1,class:"labels-x"},y={class:"status"},b={key:0,class:"actions"},x={key:1,class:"player"},w={key:0,class:"buttons"},q={class:"info"},B={key:0},C={key:1},P={key:2},N={class:"watchers"};(0,a.popScopeId)();const S=s(((e,t,o,S,V,z)=>{const E=(0,a.resolveComponent)("MkUserName"),$=(0,a.resolveComponent)("MkA"),T=(0,a.resolveComponent)("Mfm"),D=(0,a.resolveComponent)("MkEllipsis"),_=(0,a.resolveComponent)("fa"),U=(0,a.resolveComponent)("MkButton"),A=(0,a.resolveComponent)("MkAvatar");return(0,a.openBlock)(),(0,a.createBlock)("div",n,[(0,a.createVNode)("header",null,[(0,a.createVNode)("b",null,[(0,a.createVNode)($,{to:e.userPage(e.blackUser)},{default:s((()=>[(0,a.createVNode)(E,{user:e.blackUser},null,8,["user"])])),_:1},8,["to"])]),(0,a.createTextVNode)("("+(0,a.toDisplayString)(e.$ts._reversi.black)+") vs ",1),(0,a.createVNode)("b",null,[(0,a.createVNode)($,{to:e.userPage(e.whiteUser)},{default:s((()=>[(0,a.createVNode)(E,{user:e.whiteUser},null,8,["user"])])),_:1},8,["to"])]),(0,a.createTextVNode)("("+(0,a.toDisplayString)(e.$ts._reversi.white)+")",1)]),(0,a.createVNode)("div",r,[e.iAmPlayer||e.game.isEnded?(0,a.createCommentVNode)("",!0):((0,a.openBlock)(),(0,a.createBlock)("p",i,[(0,a.createVNode)(T,{key:"turn:"+e.turnUser().name,text:e.$t("_reversi.turnOf",{name:e.turnUser().name}),plain:!0,"custom-emojis":e.turnUser().emojis},null,8,["text","custom-emojis"]),(0,a.createVNode)(D)])),e.logPos!=e.logs.length?((0,a.openBlock)(),(0,a.createBlock)("p",l,[(0,a.createVNode)(T,{key:"past-turn-of:"+e.turnUser().name,text:e.$t("_reversi.pastTurnOf",{name:e.turnUser().name}),plain:!0,"custom-emojis":e.turnUser().emojis},null,8,["text","custom-emojis"])])):(0,a.createCommentVNode)("",!0),!e.iAmPlayer||e.game.isEnded||e.isMyTurn()?(0,a.createCommentVNode)("",!0):((0,a.openBlock)(),(0,a.createBlock)("p",c,[(0,a.createTextVNode)((0,a.toDisplayString)(e.$ts._reversi.opponentTurn),1),(0,a.createVNode)(D)])),e.iAmPlayer&&!e.game.isEnded&&e.isMyTurn()?((0,a.openBlock)(),(0,a.createBlock)("p",d,(0,a.toDisplayString)(e.$ts._reversi.myTurn),1)):(0,a.createCommentVNode)("",!0),e.game.isEnded&&e.logPos==e.logs.length?((0,a.openBlock)(),(0,a.createBlock)("p",h,[e.game.winner?((0,a.openBlock)(),(0,a.createBlock)(a.Fragment,{key:0},[(0,a.createVNode)(T,{key:"won",text:e.$t("_reversi.won",{name:e.game.winner.name}),plain:!0,"custom-emojis":e.game.winner.emojis},null,8,["text","custom-emojis"]),null!=e.game.surrendered?((0,a.openBlock)(),(0,a.createBlock)("span",u," ("+(0,a.toDisplayString)(e.$ts._reversi.surrendered)+")",1)):(0,a.createCommentVNode)("",!0)],64)):((0,a.openBlock)(),(0,a.createBlock)(a.Fragment,{key:1},[(0,a.createTextVNode)((0,a.toDisplayString)(e.$ts._reversi.drawn),1)],64))])):(0,a.createCommentVNode)("",!0)]),(0,a.createVNode)("div",p,[e.$store.state.gamesReversiShowBoardLabels?((0,a.openBlock)(),(0,a.createBlock)("div",g,[((0,a.openBlock)(!0),(0,a.createBlock)(a.Fragment,null,(0,a.renderList)(e.game.map[0].length,(e=>((0,a.openBlock)(),(0,a.createBlock)("span",null,(0,a.toDisplayString)(String.fromCharCode(64+e)),1)))),256))])):(0,a.createCommentVNode)("",!0),(0,a.createVNode)("div",m,[e.$store.state.gamesReversiShowBoardLabels?((0,a.openBlock)(),(0,a.createBlock)("div",f,[((0,a.openBlock)(!0),(0,a.createBlock)(a.Fragment,null,(0,a.renderList)(e.game.map.length,(e=>((0,a.openBlock)(),(0,a.createBlock)("div",null,(0,a.toDisplayString)(e),1)))),256))])):(0,a.createCommentVNode)("",!0),(0,a.createVNode)("div",{class:"cells",style:e.cellsStyle},[((0,a.openBlock)(!0),(0,a.createBlock)(a.Fragment,null,(0,a.renderList)(e.o.board,((t,o)=>((0,a.openBlock)(),(0,a.createBlock)("div",{class:{empty:null==t,none:"null"==e.o.map[o],isEnded:e.game.isEnded,myTurn:!e.game.isEnded&&e.isMyTurn(),can:e.turnUser()?e.o.canPut(e.turnUser().id==e.blackUser.id,o):null,prev:e.o.prevPos==o},onClick:t=>e.set(o),title:`${String.fromCharCode(65+e.o.transformPosToXy(o)[0])}${e.o.transformPosToXy(o)[1]+1}`},[(e.$store.state.gamesReversiUseAvatarStones,(0,a.openBlock)(),(0,a.createBlock)(a.Fragment,{key:0},[!0===t?((0,a.openBlock)(),(0,a.createBlock)("img",{key:0,src:e.blackUser.avatarUrl,alt:"black"},null,8,["src"])):(0,a.createCommentVNode)("",!0),!1===t?((0,a.openBlock)(),(0,a.createBlock)("img",{key:1,src:e.whiteUser.avatarUrl,alt:"white"},null,8,["src"])):(0,a.createCommentVNode)("",!0)],64))],10,["onClick","title"])))),256))],4),e.$store.state.gamesReversiShowBoardLabels?((0,a.openBlock)(),(0,a.createBlock)("div",v,[((0,a.openBlock)(!0),(0,a.createBlock)(a.Fragment,null,(0,a.renderList)(e.game.map.length,(e=>((0,a.openBlock)(),(0,a.createBlock)("div",null,(0,a.toDisplayString)(e),1)))),256))])):(0,a.createCommentVNode)("",!0)]),e.$store.state.gamesReversiShowBoardLabels?((0,a.openBlock)(),(0,a.createBlock)("div",k,[((0,a.openBlock)(!0),(0,a.createBlock)(a.Fragment,null,(0,a.renderList)(e.game.map[0].length,(e=>((0,a.openBlock)(),(0,a.createBlock)("span",null,(0,a.toDisplayString)(String.fromCharCode(64+e)),1)))),256))])):(0,a.createCommentVNode)("",!0)]),(0,a.createVNode)("p",y,[(0,a.createVNode)("b",null,(0,a.toDisplayString)(e.$t("_reversi.turnCount",{count:e.logPos})),1),(0,a.createTextVNode)(" "+(0,a.toDisplayString)(e.$ts._reversi.black)+":"+(0,a.toDisplayString)(e.o.blackCount)+" "+(0,a.toDisplayString)(e.$ts._reversi.white)+":"+(0,a.toDisplayString)(e.o.whiteCount)+" "+(0,a.toDisplayString)(e.$ts._reversi.total)+":"+(0,a.toDisplayString)(e.o.blackCount+e.o.whiteCount),1)]),!e.game.isEnded&&e.iAmPlayer?((0,a.openBlock)(),(0,a.createBlock)("div",b,[(0,a.createVNode)(U,{onClick:e.surrender,inline:""},{default:s((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(e.$ts._reversi.surrender),1)])),_:1},8,["onClick"])])):(0,a.createCommentVNode)("",!0),e.game.isEnded?((0,a.openBlock)(),(0,a.createBlock)("div",x,[(0,a.createVNode)("span",null,(0,a.toDisplayString)(e.logPos)+" / "+(0,a.toDisplayString)(e.logs.length),1),e.autoplaying?(0,a.createCommentVNode)("",!0):((0,a.openBlock)(),(0,a.createBlock)("div",w,[(0,a.createVNode)(U,{inline:"",onClick:t[1]||(t[1]=t=>e.logPos=0),disabled:0==e.logPos},{default:s((()=>[(0,a.createVNode)(_,{icon:e.faAngleDoubleLeft},null,8,["icon"])])),_:1},8,["disabled"]),(0,a.createVNode)(U,{inline:"",onClick:t[2]||(t[2]=t=>e.logPos--),disabled:0==e.logPos},{default:s((()=>[(0,a.createVNode)(_,{icon:e.faAngleLeft},null,8,["icon"])])),_:1},8,["disabled"]),(0,a.createVNode)(U,{inline:"",onClick:t[3]||(t[3]=t=>e.logPos++),disabled:e.logPos==e.logs.length},{default:s((()=>[(0,a.createVNode)(_,{icon:e.faAngleRight},null,8,["icon"])])),_:1},8,["disabled"]),(0,a.createVNode)(U,{inline:"",onClick:t[4]||(t[4]=t=>e.logPos=e.logs.length),disabled:e.logPos==e.logs.length},{default:s((()=>[(0,a.createVNode)(_,{icon:e.faAngleDoubleRight},null,8,["icon"])])),_:1},8,["disabled"])])),(0,a.createVNode)(U,{onClick:t[5]||(t[5]=t=>e.autoplay()),disabled:e.autoplaying,style:{margin:"var(--margin) auto 0 auto"}},{default:s((()=>[(0,a.createVNode)(_,{icon:e.faPlay},null,8,["icon"])])),_:1},8,["disabled"])])):(0,a.createCommentVNode)("",!0),(0,a.createVNode)("div",q,[e.game.isLlotheo?((0,a.openBlock)(),(0,a.createBlock)("p",B,(0,a.toDisplayString)(e.$ts._reversi.isLlotheo),1)):(0,a.createCommentVNode)("",!0),e.game.loopedBoard?((0,a.openBlock)(),(0,a.createBlock)("p",C,(0,a.toDisplayString)(e.$ts._reversi.loopedMap),1)):(0,a.createCommentVNode)("",!0),e.game.canPutEverywhere?((0,a.openBlock)(),(0,a.createBlock)("p",P,(0,a.toDisplayString)(e.$ts._reversi.canPutEverywhere),1)):(0,a.createCommentVNode)("",!0)]),(0,a.createVNode)("div",N,[((0,a.openBlock)(!0),(0,a.createBlock)(a.Fragment,null,(0,a.renderList)(e.watchers,(e=>((0,a.openBlock)(),(0,a.createBlock)(A,{key:e.id,user:e,class:"avatar"},null,8,["user"])))),128))])])}));var V=o(51436),z=o(56024),E=o(34606),$=o(25300);const T=!0,D=!1;class _{constructor(e,t){this.turn=T,this.prevPos=-1,this.prevColor=null,this.logs=[],this.put=this.put.bind(this),this.opts=t,null==this.opts.isLlotheo&&(this.opts.isLlotheo=!1),null==this.opts.canPutEverywhere&&(this.opts.canPutEverywhere=!1),null==this.opts.loopedBoard&&(this.opts.loopedBoard=!1),this.mapWidth=e[0].length,this.mapHeight=e.length;const o=e.join("");this.board=o.split("").map((e=>"-"===e?null:"b"===e?T:"w"===e?D:void 0)),this.map=o.split("").map((e=>"-"===e||"b"===e||"w"===e?"empty":"null")),this.canPutSomewhere(T)||(this.turn=this.canPutSomewhere(D)?D:null)}get blackCount(){return(0,$.QX)(T,this.board)}get whiteCount(){return(0,$.QX)(D,this.board)}transformPosToXy(e){return[e%this.mapWidth,Math.floor(e/this.mapWidth)]}transformXyToPos(e,t){return e+t*this.mapWidth}put(e,t){this.prevPos=t,this.prevColor=e,this.board[t]=e;const o=this.effects(e,t);for(const t of o)this.board[t]=e;const a=this.turn;this.logs.push({color:e,pos:t,effects:o,turn:a}),this.calcTurn()}calcTurn(){this.turn=this.canPutSomewhere(!this.prevColor)?!this.prevColor:this.canPutSomewhere(this.prevColor)?this.prevColor:null}undo(){const e=this.logs.pop();this.prevColor=e.color,this.prevPos=e.pos,this.board[e.pos]=null;for(const t of e.effects){const e=this.board[t];this.board[t]=!e}this.turn=e.turn}mapDataGet(e){const[t,o]=this.transformPosToXy(e);return t<0||o<0||t>=this.mapWidth||o>=this.mapHeight?"null":this.map[e]}puttablePlaces(e){return Array.from(this.board.keys()).filter((t=>this.canPut(e,t)))}canPutSomewhere(e){return this.puttablePlaces(e).length>0}canPut(e,t){return null===this.board[t]&&(this.opts.canPutEverywhere?"empty"==this.mapDataGet(t):0!==this.effects(e,t).length)}effects(e,t){const o=!e;return(0,$.zo)([[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]].map((([a,s])=>{const n=(e,t)=>[e+a,t+s],r=[];let[i,l]=this.transformPosToXy(t);for(;;){if([i,l]=n(i,l),this.opts.loopedBoard&&this.transformXyToPos(i=(i%this.mapWidth+this.mapWidth)%this.mapWidth,l=(l%this.mapHeight+this.mapHeight)%this.mapHeight)===t)return r;if(-1===i||-1===l||i===this.mapWidth||l===this.mapHeight)return[];const a=this.transformXyToPos(i,l);if("null"===this.mapDataGet(a))return[];const s=this.board[a];if(null===s)return[];if(s===o&&r.push(a),s===e)return r}})))}get isEnded(){return null===this.turn}get winner(){return this.isEnded?this.blackCount==this.whiteCount?null:this.opts.isLlotheo===this.blackCount>this.whiteCount?D:T:void 0}}var U=o(42453),A=o(55006),L=o(10192),I=o(56858);const R=(0,a.defineComponent)({components:{MkButton:U.Z},props:{initGame:{type:Object,require:!0},connection:{type:Object,require:!0}},data(){return{game:JSON.parse(JSON.stringify(this.initGame)),o:null,logs:[],logPos:0,watchers:[],pollingClock:null,faAngleDoubleLeft:V.UXu,faAngleLeft:V.EyR,faAngleRight:V.yOZ,faAngleDoubleRight:V.cLY,fasCircle:V.diR,farCircle:z.di,faPlay:V.zc}},computed:{iAmPlayer(){return!!this.$i&&(this.game.user1Id==this.$i.id||this.game.user2Id==this.$i.id)},myColor(){return this.iAmPlayer?this.game.user1Id==this.$i.id&&1==this.game.black||this.game.user2Id==this.$i.id&&2==this.game.black:null},opColor(){return this.iAmPlayer?!0!==this.myColor:null},blackUser(){return 1==this.game.black?this.game.user1:this.game.user2},whiteUser(){return 1==this.game.black?this.game.user2:this.game.user1},cellsStyle(){return{"grid-template-rows":`repeat(${this.game.map.length}, 1fr)`,"grid-template-columns":`repeat(${this.game.map[0].length}, 1fr)`}}},watch:{logPos(e){if(!this.game.isEnded)return;const t=new _(this.game.map,{isLlotheo:this.game.isLlotheo,canPutEverywhere:this.game.canPutEverywhere,loopedBoard:this.game.loopedBoard});for(const o of this.logs.slice(0,e))t.put(o.color,o.pos);this.o=t}},created(){this.o=new _(this.game.map,{isLlotheo:this.game.isLlotheo,canPutEverywhere:this.game.canPutEverywhere,loopedBoard:this.game.loopedBoard});for(const e of this.game.logs)this.o.put(e.color,e.pos);this.logs=this.game.logs,this.logPos=this.logs.length,this.game.isStarted&&!this.game.isEnded&&(this.pollingClock=setInterval((()=>{if(this.game.isEnded)return;const e=E.str(this.logs.map((e=>e.pos.toString())).join(""));this.connection.send("check",{crc32:e})}),3e3))},mounted(){this.connection.on("set",this.onSet),this.connection.on("rescue",this.onRescue),this.connection.on("ended",this.onEnded),this.connection.on("watchers",this.onWatchers)},beforeUnmount(){this.connection.off("set",this.onSet),this.connection.off("rescue",this.onRescue),this.connection.off("ended",this.onEnded),this.connection.off("watchers",this.onWatchers),clearInterval(this.pollingClock)},methods:{userPage:A.tL,turnUser(){return!0===this.o.turn?1==this.game.black?this.game.user1:this.game.user2:!1===this.o.turn?1==this.game.black?this.game.user2:this.game.user1:null},isMyTurn(){return!!this.iAmPlayer&&(null!=this.turnUser()&&this.turnUser().id==this.$i.id)},set(e){this.game.isEnded||this.iAmPlayer&&this.isMyTurn()&&this.o.canPut(this.myColor,e)&&(this.o.put(this.myColor,e),I.h(this.myColor?"reversiPutBlack":"reversiPutWhite"),this.connection.send("set",{pos:e}),this.checkEnd(),this.$forceUpdate())},onSet(e){this.logs.push(e),this.logPos++,this.o.put(e.color,e.pos),this.checkEnd(),this.$forceUpdate(),e.color!==this.myColor&&I.h(e.color?"reversiPutBlack":"reversiPutWhite")},onEnded(e){this.game=JSON.parse(JSON.stringify(e.game))},checkEnd(){this.game.isEnded=this.o.isEnded,this.game.isEnded&&(!0===this.o.winner?(this.game.winnerId=1==this.game.black?this.game.user1Id:this.game.user2Id,this.game.winner=1==this.game.black?this.game.user1:this.game.user2):!1===this.o.winner?(this.game.winnerId=1==this.game.black?this.game.user2Id:this.game.user1Id,this.game.winner=1==this.game.black?this.game.user2:this.game.user1):(this.game.winnerId=null,this.game.winner=null))},onRescue(e){this.game=JSON.parse(JSON.stringify(e)),this.o=new _(this.game.map,{isLlotheo:this.game.isLlotheo,canPutEverywhere:this.game.canPutEverywhere,loopedBoard:this.game.loopedBoard});for(const e of this.game.logs)this.o.put(e.color,e.pos,!0);this.logs=this.game.logs,this.logPos=this.logs.length,this.checkEnd(),this.$forceUpdate()},onWatchers(e){this.watchers=e},surrender(){L.hi("games/reversi/games/surrender",{gameId:this.game.id})},autoplay(){this.autoplaying=!0,this.logPos=0,setTimeout((()=>{this.logPos=1;let e=1,t=this.game.logs[0];const o=()=>{const a=this.game.logs[e],s=new Date(a.at).getTime()-new Date(t.at).getTime();setTimeout((()=>{e++,this.logPos++,t=a,e<this.game.logs.length?o():this.autoplaying=!1}),s)};o()}),1e3)}}});o(81084);R.render=S,R.__scopeId="data-v-6dd18f75";const j=R},11855:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>d});var a=o(55393);const s={key:0};var n=o(50087),r=o(96735),i=o(10192),l=o(51436);const c=(0,a.defineComponent)({components:{GameSetting:n.default,GameBoard:r.default},props:{gameId:{type:String,required:!0}},data(){return{INFO:{title:this.$ts._reversi.reversi,icon:l.l9D},game:null,connection:null}},watch:{gameId(){this.fetch()}},mounted(){this.fetch()},beforeUnmount(){this.connection&&this.connection.dispose()},methods:{fetch(){i.hi("games/reversi/games/show",{gameId:this.gameId}).then((e=>{this.game=e,this.connection&&this.connection.dispose(),this.connection=i.Vw.connectToChannel("gamesReversiGame",{gameId:this.game.id}),this.connection.on("started",this.onStarted)}))},onStarted(e){Object.assign(this.game,e)}}});c.render=function(e,t,o,n,r,i){const l=(0,a.resolveComponent)("MkLoading"),c=(0,a.resolveComponent)("GameSetting"),d=(0,a.resolveComponent)("GameBoard");return null==e.game?((0,a.openBlock)(),(0,a.createBlock)("div",s,[(0,a.createVNode)(l)])):e.game.isStarted?((0,a.openBlock)(),(0,a.createBlock)(d,{key:2,"init-game":e.game,connection:e.connection},null,8,["init-game","connection"])):((0,a.openBlock)(),(0,a.createBlock)(c,{key:1,"init-game":e.game,connection:e.connection},null,8,["init-game","connection"]))};const d=c},81084:(e,t,o)=>{var a=o(3575);"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);(0,o(45346).Z)("363ef8d9",a,!0,{})}}]);